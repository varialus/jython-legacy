<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What’s New in Python 2.3 &mdash; Jython v2.5.0 documentation</title>
    <link rel="stylesheet" href="../_static/green-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.5.0',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="copyright" title="Copyright" href="../copyright.html" />
    <link rel="top" title="Jython v2.5.0 documentation" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">Jython v2.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/jython.png" alt="Logo"/>
            </a></p>
            <h3><a href="../index.html">Table Of Contents</a></h3>
            <ul>
<li><a class="reference external" href="">What&#8217;s New in Python 2.3</a><ul>
<li><a class="reference external" href="#pep-218-a-standard-set-datatype">PEP 218: A Standard Set Datatype</a></li>
<li><a class="reference external" href="#pep-255-simple-generators">PEP 255: Simple Generators</a></li>
<li><a class="reference external" href="#pep-263-source-code-encodings">PEP 263: Source Code Encodings</a></li>
<li><a class="reference external" href="#pep-273-importing-modules-from-zip-archives">PEP 273: Importing Modules from ZIP Archives</a></li>
<li><a class="reference external" href="#pep-277-unicode-file-name-support-for-windows-nt">PEP 277: Unicode file name support for Windows NT</a></li>
<li><a class="reference external" href="#pep-278-universal-newline-support">PEP 278: Universal Newline Support</a></li>
<li><a class="reference external" href="#pep-279-enumerate">PEP 279: enumerate()</a></li>
<li><a class="reference external" href="#pep-282-the-logging-package">PEP 282: The logging Package</a></li>
<li><a class="reference external" href="#pep-285-a-boolean-type">PEP 285: A Boolean Type</a></li>
<li><a class="reference external" href="#pep-293-codec-error-handling-callbacks">PEP 293: Codec Error Handling Callbacks</a></li>
<li><a class="reference external" href="#pep-301-package-index-and-metadata-for-distutils">PEP 301: Package Index and Metadata for Distutils</a></li>
<li><a class="reference external" href="#pep-302-new-import-hooks">PEP 302: New Import Hooks</a></li>
<li><a class="reference external" href="#pep-305-comma-separated-files">PEP 305: Comma-separated Files</a></li>
<li><a class="reference external" href="#pep-307-pickle-enhancements">PEP 307: Pickle Enhancements</a></li>
<li><a class="reference external" href="#extended-slices">Extended Slices</a></li>
<li><a class="reference external" href="#other-language-changes">Other Language Changes</a><ul>
<li><a class="reference external" href="#string-changes">String Changes</a></li>
<li><a class="reference external" href="#optimizations">Optimizations</a></li>
</ul>
</li>
<li><a class="reference external" href="#new-improved-and-deprecated-modules">New, Improved, and Deprecated Modules</a><ul>
<li><a class="reference external" href="#date-time-type">Date/Time Type</a></li>
<li><a class="reference external" href="#the-optparse-module">The optparse Module</a></li>
</ul>
</li>
<li><a class="reference external" href="#pymalloc-a-specialized-object-allocator">Pymalloc: A Specialized Object Allocator</a></li>
<li><a class="reference external" href="#build-and-c-api-changes">Build and C API Changes</a><ul>
<li><a class="reference external" href="#port-specific-changes">Port-Specific Changes</a></li>
</ul>
</li>
<li><a class="reference external" href="#other-changes-and-fixes">Other Changes and Fixes</a></li>
<li><a class="reference external" href="#porting-to-python-2-3">Porting to Python 2.3</a></li>
<li><a class="reference external" href="#acknowledgements">Acknowledgements</a></li>
</ul>
</li>
</ul>

            <h3>This Page</h3>
            <ul class="this-page-menu">
              <li><a href="../_sources/whatsnew/2.3.txt"
                     rel="nofollow">Show Source</a></li>
            </ul>
          <div id="searchbox" style="display: none">
            <h3>Quick search</h3>
              <form class="search" action="../search.html" method="get">
                <input type="text" name="q" size="18" />
                <input type="submit" value="Go" />
                <input type="hidden" name="check_keywords" value="yes" />
                <input type="hidden" name="area" value="default" />
              </form>
              <p class="searchtip" style="font-size: 90%">
              Enter search terms or a module, class or function name.
              </p>
          </div>
          <script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="what-s-new-in-python-2-3">
<h1>What&#8217;s New in Python 2.3<a class="headerlink" href="#what-s-new-in-python-2-3" title="Permalink to this headline">¶</a></h1>
<dl class="docutils">
<dt>Author:</dt>
<dd>A.M. Kuchling</dd>
</dl>
<p>This article explains the new features in Python 2.3.  Python 2.3 was
released on July 29, 2003.</p>
<p>The main themes for Python 2.3 are polishing some of the features
added in 2.2, adding various small but useful enhancements to the core
language, and expanding the standard library.  The new object model
introduced in the previous version has benefited from 18 months of
bugfixes and from optimization efforts that have improved the
performance of new-style classes.  A few new built-in functions have
been added such as <tt class="docutils literal"><span class="pre">sum()</span></tt> and <tt class="docutils literal"><span class="pre">enumerate()</span></tt>.  The <tt class="docutils literal"><span class="pre">in</span></tt> operator
can now be used for substring searches (e.g. <tt class="docutils literal"><span class="pre">&quot;ab&quot;</span> <span class="pre">in</span> <span class="pre">&quot;abc&quot;</span></tt> returns
<tt class="xref docutils literal"><span class="pre">True</span></tt>).</p>
<p>Some of the many new library features include Boolean, set, heap, and
date/time data types, the ability to import modules from ZIP-format
archives, metadata support for the long-awaited Python catalog, an
updated version of IDLE, and modules for logging messages, wrapping
text, parsing CSV files, processing command-line options, using
BerkeleyDB databases...  the list of new and enhanced modules is
lengthy.</p>
<p>This article doesn&#8217;t attempt to provide a complete specification of
the new features, but instead provides a convenient overview.  For
full details, you should refer to the documentation for Python 2.3,
such as the Python Library Reference and the Python Reference Manual.
If you want to understand the complete implementation and design
rationale, refer to the PEP for a particular new feature.</p>
<div class="section" id="pep-218-a-standard-set-datatype">
<h2>PEP 218: A Standard Set Datatype<a class="headerlink" href="#pep-218-a-standard-set-datatype" title="Permalink to this headline">¶</a></h2>
<p>The new <tt class="docutils literal"><span class="pre">sets</span></tt> module contains an implementation of a set datatype.
The <tt class="docutils literal"><span class="pre">Set</span></tt> class is for mutable sets, sets that can have members
added and removed.  The <tt class="docutils literal"><span class="pre">ImmutableSet</span></tt> class is for sets that can&#8217;t
be modified, and instances of <tt class="docutils literal"><span class="pre">ImmutableSet</span></tt> can therefore be used
as dictionary keys. Sets are built on top of dictionaries, so the
elements within a set must be hashable.</p>
<p>Here&#8217;s a simple example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span>
<span class="go">Set([1, 2, 3])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">1</span> <span class="ow">in</span> <span class="n">S</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="mf">0</span> <span class="ow">in</span> <span class="n">S</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mf">5</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mf">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S</span>
<span class="go">Set([1, 2, 5])</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The union and intersection of sets can be computed with the
<tt class="docutils literal"><span class="pre">union()</span></tt> and <tt class="docutils literal"><span class="pre">intersection()</span></tt> methods; an alternative notation
uses the bitwise operators <tt class="docutils literal"><span class="pre">&amp;</span></tt> and <tt class="docutils literal"><span class="pre">|</span></tt>. Mutable sets also have in-
place versions of these methods, <tt class="docutils literal"><span class="pre">union_update()</span></tt> and
<tt class="docutils literal"><span class="pre">intersection_update()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S2</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">4</span><span class="p">,</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="go">Set([1, 2, 3, 4, 5, 6])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">|</span> <span class="n">S2</span>                  <span class="c"># Alternative notation</span>
<span class="go">Set([1, 2, 3, 4, 5, 6])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="go">Set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">&amp;</span> <span class="n">S2</span>                  <span class="c"># Alternative notation</span>
<span class="go">Set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">union_update</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span>
<span class="go">Set([1, 2, 3, 4, 5, 6])</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>It&#8217;s also possible to take the symmetric difference of two sets.  This
is the set of all elements in the union that aren&#8217;t in the
intersection.  Another way of putting it is that the symmetric
difference contains all elements that are in exactly one set.  Again,
there&#8217;s an alternative notation (<tt class="docutils literal"><span class="pre">^</span></tt>), and an in- place version with
the ungainly name <tt class="docutils literal"><span class="pre">symmetric_difference_update()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S2</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">3</span><span class="p">,</span><span class="mf">4</span><span class="p">,</span><span class="mf">5</span><span class="p">,</span><span class="mf">6</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">symmetric_difference</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="go">Set([1, 2, 5, 6])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">^</span> <span class="n">S2</span>
<span class="go">Set([1, 2, 5, 6])</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>There are also <tt class="docutils literal"><span class="pre">issubset()</span></tt> and <tt class="docutils literal"><span class="pre">issuperset()</span></tt> methods for
checking whether one set is a subset or superset of another:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S2</span> <span class="o">=</span> <span class="n">sets</span><span class="o">.</span><span class="n">Set</span><span class="p">([</span><span class="mf">2</span><span class="p">,</span><span class="mf">3</span><span class="p">])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S2</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">S1</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">S1</span><span class="o">.</span><span class="n">issuperset</span><span class="p">(</span><span class="n">S2</span><span class="p">)</span>
<span class="go">True</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 218</strong> - Adding a Built-In Set Object Type</dt>
<dd>PEP written by Greg V. Wilson. Implemented by Greg V. Wilson,
Alex Martelli, and GvR.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-255-simple-generators">
<h2>PEP 255: Simple Generators<a class="headerlink" href="#pep-255-simple-generators" title="Permalink to this headline">¶</a></h2>
<p>In Python 2.2, generators were added as an optional feature, to be
enabled by a <tt class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">generators</span></tt> directive.  In 2.3
generators no longer need to be specially enabled, and are now always
present; this means that <tt class="docutils literal"><span class="pre">yield</span></tt> is now always a keyword.  The rest
of this section is a copy of the description of generators from the
&#8220;What&#8217;s New in Python 2.2&#8221; document; if you read it back when Python
2.2 came out, you can skip the rest of this section.</p>
<p>You&#8217;re doubtless familiar with how function calls work in Python or C.
When you call a function, it gets a private namespace where its local
variables are created.  When the function reaches a <tt class="docutils literal"><span class="pre">return</span></tt>
statement, the local variables are destroyed and the resulting value
is returned to the caller.  A later call to the same function will get
a fresh new set of local variables. But, what if the local variables
weren&#8217;t thrown away on exiting a function? What if you could later
resume the function where it left off?  This is what generators
provide; they can be thought of as resumable functions.</p>
<p>Here&#8217;s the simplest example of a generator function:</p>
<blockquote>
<dl class="docutils">
<dt>def generate_ints(N):</dt>
<dd><dl class="first last docutils">
<dt>for i in range(N):</dt>
<dd>yield i</dd>
</dl>
</dd>
</dl>
</blockquote>
<p>A new keyword, <tt class="docutils literal"><span class="pre">yield</span></tt>, was introduced for generators.  Any function
containing a <tt class="docutils literal"><span class="pre">yield</span></tt> statement is a generator function; this is
detected by Python&#8217;s bytecode compiler which compiles the function
specially as a result.</p>
<p>When you call a generator function, it doesn&#8217;t return a single value;
instead it returns a generator object that supports the iterator
protocol.  On executing the <tt class="docutils literal"><span class="pre">yield</span></tt> statement, the generator outputs
the value of <tt class="docutils literal"><span class="pre">i</span></tt>, similar to a <tt class="docutils literal"><span class="pre">return</span></tt> statement.  The big
difference between <tt class="docutils literal"><span class="pre">yield</span></tt> and a <tt class="docutils literal"><span class="pre">return</span></tt> statement is that on
reaching a <tt class="docutils literal"><span class="pre">yield</span></tt> the generator&#8217;s state of execution is suspended
and local variables are preserved.  On the next call to the
generator&#8217;s <tt class="docutils literal"><span class="pre">.next()</span></tt> method, the function will resume executing
immediately after the <tt class="docutils literal"><span class="pre">yield</span></tt> statement.  (For complicated reasons,
the <tt class="docutils literal"><span class="pre">yield</span></tt> statement isn&#8217;t allowed inside the <tt class="docutils literal"><span class="pre">try</span></tt> block of a
<tt class="docutils literal"><span class="pre">try</span></tt>...``finally`` statement; read <strong>PEP 255</strong> for a full
explanation of the interaction between <tt class="docutils literal"><span class="pre">yield</span></tt> and exceptions.)</p>
<p>Here&#8217;s a sample usage of the <tt class="docutils literal"><span class="pre">generate_ints()</span></tt> generator:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span> <span class="o">=</span> <span class="n">generate_ints</span><span class="p">(</span><span class="mf">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span>
<span class="go">&lt;generator object at 0x8117f90&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">gen</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">2</span>, in <span class="n-Identifier">generate_ints</span>
<span class="nc">StopIteration</span>
</pre></div>
</div>
<p>You could equally write <tt class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">generate_ints(5)</span></tt>, or <tt class="docutils literal"><span class="pre">a,b,c</span> <span class="pre">=</span>
<span class="pre">generate_ints(3)</span></tt>.</p>
<p>Inside a generator function, the <tt class="docutils literal"><span class="pre">return</span></tt> statement can only be used
without a value, and signals the end of the procession of values;
afterwards the generator cannot return any further values. <tt class="docutils literal"><span class="pre">return</span></tt>
with a value, such as <tt class="docutils literal"><span class="pre">return</span> <span class="pre">5</span></tt>, is a syntax error inside a
generator function.  The end of the generator&#8217;s results can also be
indicated by raising <tt class="docutils literal"><span class="pre">StopIteration</span></tt> manually, or by just letting
the flow of execution fall off the bottom of the function.</p>
<p>You could achieve the effect of generators manually by writing your
own class and storing all the local variables of the generator as
instance variables.  For example, returning a list of integers could
be done by setting <tt class="docutils literal"><span class="pre">self.count</span></tt> to 0, and having the <tt class="docutils literal"><span class="pre">next()</span></tt>
method increment <tt class="docutils literal"><span class="pre">self.count</span></tt> and return it. However, for a
moderately complicated generator, writing a corresponding class would
be much messier. <tt class="docutils literal"><span class="pre">Lib/test/test_generators.py</span></tt> contains a number of
more interesting examples.  The simplest one implements an in-order
traversal of a tree using generators recursively.</p>
<blockquote>
<p># A recursive generator that generates Tree leaves in in-order.
def inorder(t):</p>
<blockquote>
<dl class="docutils">
<dt>if t:</dt>
<dd><dl class="first docutils">
<dt>for x in inorder(t.left):</dt>
<dd>yield x</dd>
</dl>
<p>yield t.label
for x in inorder(t.right):</p>
<blockquote class="last">
yield x</blockquote>
</dd>
</dl>
</blockquote>
</blockquote>
<p>Two other examples in <tt class="docutils literal"><span class="pre">Lib/test/test_generators.py</span></tt> produce
solutions for the N-Queens problem (placing $N$ queens on an $NxN$
chess board so that no queen threatens another) and the Knight&#8217;s Tour
(a route that takes a knight to every square of an $NxN$ chessboard
without visiting any square twice).</p>
<p>The idea of generators comes from other programming languages,
especially Icon (<a class="reference external" href="http://www.cs.arizona.edu/icon/">http://www.cs.arizona.edu/icon/</a>), where the idea of
generators is central.  In Icon, every expression and function call
behaves like a generator.  One example from &#8220;An Overview of the Icon
Programming Language&#8221; at
<a class="reference external" href="http://www.cs.arizona.edu/icon/docs/ipd266.htm">http://www.cs.arizona.edu/icon/docs/ipd266.htm</a> gives an idea of what
this looks like:</p>
<blockquote>
sentence := &#8220;Store it in the neighboring harbor&#8221;
if (i := find(&#8220;or&#8221;, sentence)) &gt; 5 then write(i)</blockquote>
<p>In Icon the <tt class="docutils literal"><span class="pre">find()</span></tt> function returns the indexes at which the
substring &#8220;or&#8221; is found: 3, 23, 33.  In the <tt class="docutils literal"><span class="pre">if</span></tt> statement, <tt class="docutils literal"><span class="pre">i</span></tt> is
first assigned a value of 3, but 3 is less than 5, so the comparison
fails, and Icon retries it with the second value of 23.  23 is greater
than 5, so the comparison now succeeds, and the code prints the value
23 to the screen.</p>
<p>Python doesn&#8217;t go nearly as far as Icon in adopting generators as a
central concept.  Generators are considered part of the core Python
language, but learning or using them isn&#8217;t compulsory; if they don&#8217;t
solve any problems that you have, feel free to ignore them. One novel
feature of Python&#8217;s interface as compared to Icon&#8217;s is that a
generator&#8217;s state is represented as a concrete object (the iterator)
that can be passed around to other functions or stored in a data
structure.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 255</strong> - Simple Generators</dt>
<dd>Written by Neil Schemenauer, Tim Peters, Magnus Lie Hetland.
Implemented mostly by Neil Schemenauer and Tim Peters, with
other fixes from the Python Labs crew.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-263-source-code-encodings">
<h2>PEP 263: Source Code Encodings<a class="headerlink" href="#pep-263-source-code-encodings" title="Permalink to this headline">¶</a></h2>
<p>Python source files can now be declared as being in different
character set encodings.  Encodings are declared by including a
specially formatted comment in the first or second line of the source
file.  For example, a UTF-8 file can be declared with:</p>
<blockquote>
#!/usr/bin/env python
# -<em>- coding: UTF-8 -</em>-</blockquote>
<p>Without such an encoding declaration, the default encoding used is
7-bit ASCII. Executing or importing modules that contain string
literals with 8-bit characters and have no encoding declaration will
result in a <tt class="docutils literal"><span class="pre">DeprecationWarning</span></tt> being signalled by Python 2.3; in
2.4 this will be a syntax error.</p>
<p>The encoding declaration only affects Unicode string literals, which
will be converted to Unicode using the specified encoding.  Note that
Python identifiers are still restricted to ASCII characters, so you
can&#8217;t have variable names that use characters outside of the usual
alphanumerics.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 263</strong> - Defining Python Source Code Encodings</dt>
<dd>Written by Marc-André Lemburg and Martin von Löwis; implemented
by Suzuki Hisao and Martin von Löwis.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-273-importing-modules-from-zip-archives">
<h2>PEP 273: Importing Modules from ZIP Archives<a class="headerlink" href="#pep-273-importing-modules-from-zip-archives" title="Permalink to this headline">¶</a></h2>
<p>The new <tt class="docutils literal"><span class="pre">zipimport</span></tt> module adds support for importing modules from a
ZIP- format archive.  You don&#8217;t need to import the module explicitly;
it will be automatically imported if a ZIP archive&#8217;s filename is added
to <tt class="docutils literal"><span class="pre">sys.path</span></tt>. For example:</p>
<blockquote>
<p><a class="reference external" href="mailto:amk&#37;&#52;&#48;nyman">amk<span>&#64;</span>nyman</a>:~/src/python$ unzip -l /tmp/example.zip
Archive:  /tmp/example.zip</p>
<blockquote>
<blockquote>
Length     Date   Time    Name</blockquote>
<dl class="docutils">
<dt>&#8212;&#8212;&#8211;    &#8212;-   &#8212;-    &#8212;-</dt>
<dd>8467  11-26-02 22:30   jwzthreading.py</dd>
<dt>&#8212;&#8212;&#8211;                   &#8212;&#8212;-</dt>
<dd>8467                   1 file</dd>
</dl>
</blockquote>
<p><a class="reference external" href="mailto:amk&#37;&#52;&#48;nyman">amk<span>&#64;</span>nyman</a>:~/src/python$ ./python
Python 2.3 (#1, Aug 1 2003, 19:54:32)
&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.path.insert(0, &#8216;/tmp/example.zip&#8217;)  # Add .zip file to front of path
&gt;&gt;&gt; import jwzthreading
&gt;&gt;&gt; jwzthreading.__file__
&#8216;/tmp/example.zip/jwzthreading.py&#8217;
&gt;&gt;&gt;</p>
</blockquote>
<p>An entry in <tt class="docutils literal"><span class="pre">sys.path</span></tt> can now be the filename of a ZIP archive. The
ZIP archive can contain any kind of files, but only files named
<tt class="docutils literal"><span class="pre">*.py</span></tt>, <tt class="docutils literal"><span class="pre">*.pyc</span></tt>, or <tt class="docutils literal"><span class="pre">*.pyo</span></tt> can be imported.  If an archive only
contains <tt class="docutils literal"><span class="pre">*.py</span></tt> files, Python will not attempt to modify the archive
by adding the corresponding <tt class="docutils literal"><span class="pre">*.pyc</span></tt> file, meaning that if a ZIP
archive doesn&#8217;t contain <tt class="docutils literal"><span class="pre">*.pyc</span></tt> files, importing may be rather slow.</p>
<p>A path within the archive can also be specified to only import from a
subdirectory; for example, the path <tt class="docutils literal"><span class="pre">/tmp/example.zip/lib/</span></tt> would
only import from the <tt class="docutils literal"><span class="pre">lib/</span></tt> subdirectory within the archive.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 273</strong> - Import Modules from Zip Archives</dt>
<dd>Written by James C. Ahlstrom,  who also provided an
implementation. Python 2.3 follows the specification in <strong>PEP
273</strong>,  but uses an implementation written by Just van Rossum
that uses the import hooks described in <strong>PEP 302</strong>. See section
<em>PEP 302: New Import Hooks</em> for a description of the new import
hooks.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-277-unicode-file-name-support-for-windows-nt">
<h2>PEP 277: Unicode file name support for Windows NT<a class="headerlink" href="#pep-277-unicode-file-name-support-for-windows-nt" title="Permalink to this headline">¶</a></h2>
<p>On Windows NT, 2000, and XP, the system stores file names as Unicode
strings. Traditionally, Python has represented file names as byte
strings, which is inadequate because it renders some file names
inaccessible.</p>
<p>Python now allows using arbitrary Unicode strings (within the
limitations of the file system) for all functions that expect file
names, most notably the <tt class="docutils literal"><span class="pre">open()</span></tt> built-in function. If a Unicode
string is passed to <tt class="docutils literal"><span class="pre">os.listdir()</span></tt>, Python now returns a list of
Unicode strings.  A new function, <tt class="docutils literal"><span class="pre">os.getcwdu()</span></tt>, returns the
current directory as a Unicode string.</p>
<p>Byte strings still work as file names, and on Windows Python will
transparently convert them to Unicode using the <tt class="docutils literal"><span class="pre">mbcs</span></tt> encoding.</p>
<p>Other systems also allow Unicode strings as file names but convert
them to byte strings before passing them to the system, which can
cause a <tt class="docutils literal"><span class="pre">UnicodeError</span></tt> to be raised. Applications can test whether
arbitrary Unicode strings are supported as file names by checking
<tt class="docutils literal"><span class="pre">os.path.supports_unicode_filenames</span></tt>, a Boolean value.</p>
<p>Under MacOS, <tt class="docutils literal"><span class="pre">os.listdir()</span></tt> may now return Unicode filenames.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 277</strong> - Unicode file name support for Windows NT</dt>
<dd>Written by Neil Hodgson; implemented by Neil Hodgson, Martin von
Löwis, and Mark Hammond.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-278-universal-newline-support">
<h2>PEP 278: Universal Newline Support<a class="headerlink" href="#pep-278-universal-newline-support" title="Permalink to this headline">¶</a></h2>
<p>The three major operating systems used today are Microsoft Windows,
Apple&#8217;s Macintosh OS, and the various Unix derivatives.  A minor
irritation of cross- platform work  is that these three platforms all
use different characters to mark the ends of lines in text files.
Unix uses the linefeed (ASCII character 10), MacOS uses the carriage
return (ASCII character 13), and Windows uses a two-character sequence
of a carriage return plus a newline.</p>
<p>Python&#8217;s file objects can now support end of line conventions other
than the one followed by the platform on which Python is running.
Opening a file with the mode <tt class="docutils literal"><span class="pre">'U'</span></tt> or <tt class="docutils literal"><span class="pre">'rU'</span></tt> will open a file for
reading in universal newline mode. All three line ending conventions
will be translated to a <tt class="docutils literal"><span class="pre">'\n'</span></tt> in the strings returned by the
various file methods such as <tt class="docutils literal"><span class="pre">read()</span></tt> and <tt class="docutils literal"><span class="pre">readline()</span></tt>.</p>
<p>Universal newline support is also used when importing modules and when
executing a file with the <tt class="docutils literal"><span class="pre">execfile()</span></tt> function.  This means that
Python modules can be shared between all three operating systems
without needing to convert the line-endings.</p>
<p>This feature can be disabled when compiling Python by specifying the
<em>&#8211;without-universal-newlines</em> switch when running Python&#8217;s
<strong>configure</strong> script.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 278</strong> - Universal Newline Support</dt>
<dd>Written and implemented by Jack Jansen.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-279-enumerate">
<h2>PEP 279: enumerate()<a class="headerlink" href="#pep-279-enumerate" title="Permalink to this headline">¶</a></h2>
<p>A new built-in function, <tt class="docutils literal"><span class="pre">enumerate()</span></tt>, will make certain loops a
bit clearer.  <tt class="docutils literal"><span class="pre">enumerate(thing)</span></tt>, where <em>thing</em> is either an
iterator or a sequence, returns a iterator that will return <tt class="docutils literal"><span class="pre">(0,</span>
<span class="pre">thing[0])</span></tt>, <tt class="docutils literal"><span class="pre">(1,</span> <span class="pre">thing[1])</span></tt>, <tt class="docutils literal"><span class="pre">(2,</span> <span class="pre">thing[2])</span></tt>, and so forth.</p>
<p>A common idiom to change every element of a list looks like this:</p>
<blockquote>
<dl class="docutils">
<dt>for i in range(len(L)):</dt>
<dd>item = L[i]
# ... compute some result based on item ...
L[i] = result</dd>
</dl>
</blockquote>
<p>This can be rewritten using <tt class="docutils literal"><span class="pre">enumerate()</span></tt> as:</p>
<blockquote>
<dl class="docutils">
<dt>for i, item in enumerate(L):</dt>
<dd># ... compute some result based on item ...
L[i] = result</dd>
</dl>
</blockquote>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 279</strong> - The enumerate() built-in function</dt>
<dd>Written and implemented by Raymond D. Hettinger.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-282-the-logging-package">
<h2>PEP 282: The logging Package<a class="headerlink" href="#pep-282-the-logging-package" title="Permalink to this headline">¶</a></h2>
<p>A standard package for writing logs, <tt class="docutils literal"><span class="pre">logging</span></tt>, has been added to
Python 2.3.  It provides a powerful and flexible mechanism for
generating logging output which can then be filtered and processed in
various ways.  A configuration file written in a standard format can
be used to control the logging behavior of a program.  Python includes
handlers that will write log records to standard error or to a file or
socket, send them to the system log, or even e-mail them to a
particular address; of course, it&#8217;s also possible to write your own
handler classes.</p>
<p>The <tt class="docutils literal"><span class="pre">Logger</span></tt> class is the primary class. Most application code will
deal with one or more <tt class="docutils literal"><span class="pre">Logger</span></tt> objects, each one used by a
particular subsystem of the application. Each <tt class="docutils literal"><span class="pre">Logger</span></tt> is identified
by a name, and names are organized into a hierarchy using <tt class="docutils literal"><span class="pre">.</span></tt>  as
the component separator. For example, you might have <tt class="docutils literal"><span class="pre">Logger</span></tt>
instances named <tt class="docutils literal"><span class="pre">server</span></tt>, <tt class="docutils literal"><span class="pre">server.auth</span></tt> and <tt class="docutils literal"><span class="pre">server.network</span></tt>.
The latter two instances are below <tt class="docutils literal"><span class="pre">server</span></tt> in the hierarchy.  This
means that if you turn up the verbosity for <tt class="docutils literal"><span class="pre">server</span></tt> or direct
<tt class="docutils literal"><span class="pre">server</span></tt> messages to a different handler, the changes will also
apply to records logged to <tt class="docutils literal"><span class="pre">server.auth</span></tt> and <tt class="docutils literal"><span class="pre">server.network</span></tt>.
There&#8217;s also a root <tt class="docutils literal"><span class="pre">Logger</span></tt> that&#8217;s the parent of all other loggers.</p>
<p>For simple uses, the <tt class="docutils literal"><span class="pre">logging</span></tt> package contains some convenience
functions that always use the root log:</p>
<blockquote>
<p>import logging</p>
<p>logging.debug(&#8216;Debugging information&#8217;)
logging.info(&#8216;Informational message&#8217;)
logging.warning(&#8216;Warning:config file %s not found&#8217;, &#8216;server.conf&#8217;)
logging.error(&#8216;Error occurred&#8217;)
logging.critical(&#8216;Critical error &#8211; shutting down&#8217;)</p>
</blockquote>
<p>This produces the following output:</p>
<blockquote>
WARNING:root:Warning:config file server.conf not found
ERROR:root:Error occurred
CRITICAL:root:Critical error &#8211; shutting down</blockquote>
<p>In the default configuration, informational and debugging messages are
suppressed and the output is sent to standard error.  You can enable
the display of informational and debugging messages by calling the
<tt class="docutils literal"><span class="pre">setLevel()</span></tt> method on the root logger.</p>
<p>Notice the <tt class="docutils literal"><span class="pre">warning()</span></tt> call&#8217;s use of string formatting operators;
all of the functions for logging messages take the arguments <tt class="docutils literal"><span class="pre">(msg,</span>
<span class="pre">arg1,</span> <span class="pre">arg2,</span> <span class="pre">...)</span></tt> and log the string resulting from <tt class="docutils literal"><span class="pre">msg</span> <span class="pre">%</span> <span class="pre">(arg1,</span>
<span class="pre">arg2,</span> <span class="pre">...)</span></tt>.</p>
<p>There&#8217;s also an <tt class="docutils literal"><span class="pre">exception()</span></tt> function that records the most recent
traceback.  Any of the other functions will also record the traceback
if you specify a true value for the keyword argument <em>exc_info</em>.</p>
<blockquote>
<dl class="docutils">
<dt>def f():</dt>
<dd>try:    1/0
except: logging.exception(&#8216;Problem recorded&#8217;)</dd>
</dl>
<p>f()</p>
</blockquote>
<p>This produces the following output:</p>
<blockquote>
<p>ERROR:root:Problem recorded
Traceback (most recent call last):</p>
<blockquote>
<dl class="docutils">
<dt>File &#8220;t.py&#8221;, line 6, in f</dt>
<dd>1/0</dd>
</dl>
</blockquote>
<p>ZeroDivisionError: integer division or modulo by zero</p>
</blockquote>
<p>Slightly more advanced programs will use a logger other than the root
logger. The <tt class="docutils literal"><span class="pre">getLogger(name)()</span></tt> function is used to get a particular
log, creating it if it doesn&#8217;t exist yet. <tt class="docutils literal"><span class="pre">getLogger(None)()</span></tt>
returns the root logger.</p>
<blockquote>
<dl class="docutils">
<dt>log = logging.getLogger(&#8216;server&#8217;)</dt>
<dd>...</dd>
<dt>log.info(&#8216;Listening on port %i&#8217;, port)</dt>
<dd>...</dd>
<dt>log.critical(&#8216;Disk full&#8217;)</dt>
<dd>...</dd>
</dl>
</blockquote>
<p>Log records are usually propagated up the hierarchy, so a message
logged to <tt class="docutils literal"><span class="pre">server.auth</span></tt> is also seen by <tt class="docutils literal"><span class="pre">server</span></tt> and <tt class="docutils literal"><span class="pre">root</span></tt>, but
a <tt class="docutils literal"><span class="pre">Logger</span></tt> can prevent this by setting its <tt class="docutils literal"><span class="pre">propagate</span></tt> attribute
to <tt class="xref docutils literal"><span class="pre">False</span></tt>.</p>
<p>There are more classes provided by the <tt class="docutils literal"><span class="pre">logging</span></tt> package that can be
customized.  When a <tt class="docutils literal"><span class="pre">Logger</span></tt> instance is told to log a message, it
creates a <tt class="docutils literal"><span class="pre">LogRecord</span></tt> instance that is sent to any number of
different <tt class="docutils literal"><span class="pre">Handler</span></tt> instances.  Loggers and handlers can also have
an attached list of filters, and each filter can cause the
<tt class="docutils literal"><span class="pre">LogRecord</span></tt> to be ignored or can modify the record before passing it
along.  When they&#8217;re finally output, <tt class="docutils literal"><span class="pre">LogRecord</span></tt> instances are
converted to text by a <tt class="docutils literal"><span class="pre">Formatter</span></tt> class.  All of these classes can
be replaced by your own specially-written classes.</p>
<p>With all of these features the <tt class="docutils literal"><span class="pre">logging</span></tt> package should provide
enough flexibility for even the most complicated applications.  This
is only an incomplete overview of its features, so please see the
package&#8217;s reference documentation for all of the details.  Reading
<strong>PEP 282</strong> will also be helpful.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 282</strong> - A Logging System</dt>
<dd>Written by Vinay Sajip and Trent Mick; implemented by Vinay
Sajip.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-285-a-boolean-type">
<h2>PEP 285: A Boolean Type<a class="headerlink" href="#pep-285-a-boolean-type" title="Permalink to this headline">¶</a></h2>
<p>A Boolean type was added to Python 2.3.  Two new constants were added
to the <tt class="docutils literal"><span class="pre">__builtin__</span></tt> module, <tt class="xref docutils literal"><span class="pre">True</span></tt> and <tt class="xref docutils literal"><span class="pre">False</span></tt>.  (<tt class="xref docutils literal"><span class="pre">True</span></tt> and
<tt class="xref docutils literal"><span class="pre">False</span></tt> constants were added to the built-ins in Python 2.2.1, but
the 2.2.1 versions are simply set to integer values of 1 and 0 and
aren&#8217;t a different type.)</p>
<p>The type object for this new type is named <tt class="docutils literal"><span class="pre">bool</span></tt>; the constructor
for it takes any Python value and converts it to <tt class="xref docutils literal"><span class="pre">True</span></tt> or
<tt class="xref docutils literal"><span class="pre">False</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span><span class="mf">0</span><span class="p">)</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">([])</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bool</span><span class="p">(</span> <span class="p">(</span><span class="mf">1</span><span class="p">,)</span> <span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Most of the standard library modules and built-in functions have been
changed to return Booleans.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s">&#39;append&#39;</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
<p>Python&#8217;s Booleans were added with the primary goal of making code
clearer.  For example, if you&#8217;re reading a function and encounter the
statement <tt class="docutils literal"><span class="pre">return</span> <span class="pre">1</span></tt>, you might wonder whether the <tt class="docutils literal"><span class="pre">1</span></tt> represents
a Boolean truth value, an index, or a coefficient that multiplies some
other quantity.  If the statement is <tt class="docutils literal"><span class="pre">return</span> <span class="pre">True</span></tt>, however, the
meaning of the return value is quite clear.</p>
<p>Python&#8217;s Booleans were <em>not</em> added for the sake of strict type-
checking.  A very strict language such as Pascal would also prevent
you performing arithmetic with Booleans, and would require that the
expression in an <tt class="docutils literal"><span class="pre">if</span></tt> statement always evaluate to a Boolean result.
Python is not this strict and never will be, as <strong>PEP 285</strong> explicitly
says.  This means you can still use any expression in an <tt class="docutils literal"><span class="pre">if</span></tt>
statement, even ones that evaluate to a list or tuple or some random
object.  The Boolean type is a subclass of the <tt class="docutils literal"><span class="pre">int</span></tt> class so that
arithmetic using a Boolean still works.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="bp">True</span> <span class="o">+</span> <span class="mf">1</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">False</span> <span class="o">+</span> <span class="mf">1</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">False</span> <span class="o">*</span> <span class="mf">75</span>
<span class="go">0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="bp">True</span> <span class="o">*</span> <span class="mf">75</span>
<span class="go">75</span>
</pre></div>
</div>
<p>To sum up <tt class="xref docutils literal"><span class="pre">True</span></tt> and <tt class="xref docutils literal"><span class="pre">False</span></tt> in a sentence: they&#8217;re alternative
ways to spell the integer values 1 and 0, with the single difference
that <tt class="docutils literal"><span class="pre">str()</span></tt> and <tt class="docutils literal"><span class="pre">repr()</span></tt> return the strings <tt class="docutils literal"><span class="pre">'True'</span></tt> and
<tt class="docutils literal"><span class="pre">'False'</span></tt> instead of <tt class="docutils literal"><span class="pre">'1'</span></tt> and <tt class="docutils literal"><span class="pre">'0'</span></tt>.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 285</strong> - Adding a bool type</dt>
<dd>Written and implemented by GvR.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-293-codec-error-handling-callbacks">
<h2>PEP 293: Codec Error Handling Callbacks<a class="headerlink" href="#pep-293-codec-error-handling-callbacks" title="Permalink to this headline">¶</a></h2>
<p>When encoding a Unicode string into a byte string, unencodable
characters may be encountered.  So far, Python has allowed specifying
the error processing as either &#8220;strict&#8221; (raising <tt class="docutils literal"><span class="pre">UnicodeError</span></tt>),
&#8220;ignore&#8221; (skipping the character), or &#8220;replace&#8221; (using a question mark
in the output string), with &#8220;strict&#8221; being the default behavior. It
may be desirable to specify alternative processing of such errors,
such as inserting an XML character reference or HTML entity reference
into the converted string.</p>
<p>Python now has a flexible framework to add different processing
strategies.  New error handlers can be added with
<tt class="docutils literal"><span class="pre">codecs.register_error()</span></tt>, and codecs then can access the error
handler with <tt class="docutils literal"><span class="pre">codecs.lookup_error()</span></tt>. An equivalent C API has been
added for codecs written in C. The error handler gets the necessary
state information such as the string being converted, the position in
the string where the error was detected, and the target encoding.  The
handler can then either raise an exception or return a replacement
string.</p>
<p>Two additional error handlers have been implemented using this
framework: &#8220;backslashreplace&#8221; uses Python backslash quoting to
represent unencodable characters and &#8220;xmlcharrefreplace&#8221; emits XML
character references.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 293</strong> - Codec Error Handling Callbacks</dt>
<dd>Written and implemented by Walter Dörwald.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-301-package-index-and-metadata-for-distutils">
<h2>PEP 301: Package Index and Metadata for Distutils<a class="headerlink" href="#pep-301-package-index-and-metadata-for-distutils" title="Permalink to this headline">¶</a></h2>
<p>Support for the long-requested Python catalog makes its first
appearance in 2.3.</p>
<p>The heart of the catalog is the new Distutils <strong>register</strong> command.
Running <tt class="docutils literal"><span class="pre">python</span> <span class="pre">setup.py</span> <span class="pre">register</span></tt> will collect the metadata
describing a package, such as its name, version, maintainer,
description, &amp;c., and send it to a central catalog server.  The
resulting catalog is available from <a class="reference external" href="http://www.python.org/pypi">http://www.python.org/pypi</a>.</p>
<p>To make the catalog a bit more useful, a new optional <em>classifiers</em>
keyword argument has been added to the Distutils <tt class="docutils literal"><span class="pre">setup()</span></tt> function.
A list of Trove-style strings can be supplied to help classify the
software.</p>
<p>Here&#8217;s an example <tt class="docutils literal"><span class="pre">setup.py</span></tt> with classifiers, written to be
compatible with older versions of the Distutils:</p>
<blockquote>
<p>from distutils import core
kw = {&#8216;name&#8217;: &#8220;Quixote&#8221;,</p>
<blockquote>
&#8216;version&#8217;: &#8220;0.5.1&#8221;,
&#8216;description&#8217;: &#8220;A highly Pythonic Web application framework&#8221;,
# ...
}</blockquote>
<dl class="docutils">
<dt>if (hasattr(core, &#8216;setup_keywords&#8217;) and</dt>
<dd><p class="first">&#8216;classifiers&#8217; in core.setup_keywords):
kw[&#8216;classifiers&#8217;] = </p>
<blockquote class="last">
<dl class="docutils">
<dt>[&#8216;Topic :: Internet :: WWW/HTTP :: Dynamic Content&#8217;,</dt>
<dd>&#8216;Environment :: No Input/Output (Daemon)&#8217;,
&#8216;Intended Audience :: Developers&#8217;],</dd>
</dl>
</blockquote>
</dd>
</dl>
<p>core.setup(<a href="#id1"><span class="problematic" id="id2">**</span></a>kw)</p>
</blockquote>
<p>The full list of classifiers can be obtained by running  <tt class="docutils literal"><span class="pre">python</span>
<span class="pre">setup.py</span> <span class="pre">register</span> <span class="pre">--list-classifiers</span></tt>.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 301</strong> - Package Index and Metadata for Distutils</dt>
<dd>Written and implemented by Richard Jones.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-302-new-import-hooks">
<h2>PEP 302: New Import Hooks<a class="headerlink" href="#pep-302-new-import-hooks" title="Permalink to this headline">¶</a></h2>
<p>While it&#8217;s been possible to write custom import hooks ever since the
<tt class="docutils literal"><span class="pre">ihooks</span></tt> module was introduced in Python 1.3, no one has ever been
really happy with it because writing new import hooks is difficult and
messy.  There have been various proposed alternatives such as the
<tt class="docutils literal"><span class="pre">imputil</span></tt> and <tt class="docutils literal"><span class="pre">iu</span></tt> modules, but none of them has ever gained much
acceptance, and none of them were easily usable from C code.</p>
<p><strong>PEP 302</strong> borrows ideas from its predecessors, especially from
Gordon McMillan&#8217;s <tt class="docutils literal"><span class="pre">iu</span></tt> module.  Three new items  are added to the
<tt class="docutils literal"><span class="pre">sys</span></tt> module:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">sys.path_hooks</span></tt> is a list of callable objects; most  often
they&#8217;ll be classes.  Each callable takes a string containing a path
and either returns an importer object that will handle imports from
this path or raises an <tt class="docutils literal"><span class="pre">ImportError</span></tt> exception if it can&#8217;t handle
this path.</li>
<li><tt class="docutils literal"><span class="pre">sys.path_importer_cache</span></tt> caches importer objects for each path,
so <tt class="docutils literal"><span class="pre">sys.path_hooks</span></tt> will only need to be traversed once for each
path.</li>
<li><tt class="docutils literal"><span class="pre">sys.meta_path</span></tt> is a list of importer objects that will be
traversed before <tt class="docutils literal"><span class="pre">sys.path</span></tt> is checked.  This list is initially
empty, but user code can add objects to it.  Additional built-in and
frozen modules can be imported by an object added to this list.</li>
</ul>
<p>Importer objects must have a single method, <tt class="docutils literal"><span class="pre">find_module(fullname,</span>
<span class="pre">path=None)()</span></tt>.  <em>fullname</em> will be a module or package name, e.g.
<tt class="docutils literal"><span class="pre">string</span></tt> or <tt class="docutils literal"><span class="pre">distutils.core</span></tt>.  <tt class="docutils literal"><span class="pre">find_module()</span></tt> must return a
loader object that has a single method, <tt class="docutils literal"><span class="pre">load_module(fullname)()</span></tt>,
that creates and returns the corresponding module object.</p>
<p>Pseudo-code for Python&#8217;s new import logic, therefore, looks something
like this (simplified a bit; see <strong>PEP 302</strong> for the full details):</p>
<blockquote>
<dl class="docutils">
<dt>for mp in sys.meta_path:</dt>
<dd><p class="first">loader = mp(fullname)
if loader is not None:</p>
<blockquote class="last">
&lt;module&gt; = loader.load_module(fullname)</blockquote>
</dd>
<dt>for path in sys.path:</dt>
<dd><dl class="first last docutils">
<dt>for hook in sys.path_hooks:</dt>
<dd><dl class="first last docutils">
<dt>try:</dt>
<dd>importer = hook(path)</dd>
<dt>except ImportError:</dt>
<dd># ImportError, so try the other path hooks
pass</dd>
<dt>else:</dt>
<dd>loader = importer.find_module(fullname)
&lt;module&gt; = loader.load_module(fullname)</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
<p># Not found!
raise ImportError</p>
</blockquote>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 302</strong> - New Import Hooks</dt>
<dd>Written by Just van Rossum and Paul Moore. Implemented by Just
van Rossum.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-305-comma-separated-files">
<h2>PEP 305: Comma-separated Files<a class="headerlink" href="#pep-305-comma-separated-files" title="Permalink to this headline">¶</a></h2>
<p>Comma-separated files are a format frequently used for exporting data
from databases and spreadsheets.  Python 2.3 adds a parser for comma-
separated files.</p>
<p>Comma-separated format is deceptively simple at first glance:</p>
<blockquote>
Costs,150,200,3.95</blockquote>
<p>Read a line and call <tt class="docutils literal"><span class="pre">line.split(',')</span></tt>: what could be simpler? But
toss in string data that can contain commas, and things get more
complicated:</p>
<blockquote>
&#8220;Costs&#8221;,150,200,3.95,&#8221;Includes taxes, shipping, and sundry items&#8221;</blockquote>
<p>A big ugly regular expression can parse this, but using the new
<tt class="docutils literal"><span class="pre">csv</span></tt> package is much simpler:</p>
<blockquote>
<p>import csv</p>
<p>input = open(&#8216;datafile&#8217;, &#8216;rb&#8217;)
reader = csv.reader(input)
for line in reader:</p>
<blockquote>
print line</blockquote>
</blockquote>
<p>The <tt class="docutils literal"><span class="pre">reader()</span></tt> function takes a number of different options. The
field separator isn&#8217;t limited to the comma and can be changed to any
character, and so can the quoting and line-ending characters.</p>
<p>Different dialects of comma-separated files can be defined and
registered; currently there are two dialects, both used by Microsoft
Excel. A separate <tt class="docutils literal"><span class="pre">csv.writer</span></tt> class will generate comma-separated
files from a succession of tuples or lists, quoting strings that
contain the delimiter.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 305</strong> - CSV File API</dt>
<dd>Written and implemented  by Kevin Altis, Dave Cole, Andrew
McNamara, Skip Montanaro, Cliff Wells.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="pep-307-pickle-enhancements">
<h2>PEP 307: Pickle Enhancements<a class="headerlink" href="#pep-307-pickle-enhancements" title="Permalink to this headline">¶</a></h2>
<p>The <tt class="docutils literal"><span class="pre">pickle</span></tt> and <tt class="docutils literal"><span class="pre">cPickle</span></tt> modules received some attention during
the 2.3 development cycle.  In 2.2, new-style classes could be pickled
without difficulty, but they weren&#8217;t pickled very compactly; <strong>PEP
307</strong> quotes a trivial example where a new-style class results in a
pickled string three times longer than that for a classic class.</p>
<p>The solution was to invent a new pickle protocol.  The
<tt class="docutils literal"><span class="pre">pickle.dumps()</span></tt> function has supported a text-or-binary flag  for a
long time.  In 2.3, this flag is redefined from a Boolean to an
integer: 0 is the old text-mode pickle format, 1 is the old binary
format, and now 2 is a new 2.3-specific format.  A new constant,
<tt class="docutils literal"><span class="pre">pickle.HIGHEST_PROTOCOL</span></tt>, can be used to select the fanciest
protocol available.</p>
<p>Unpickling is no longer considered a safe operation.  2.2&#8217;s <tt class="docutils literal"><span class="pre">pickle</span></tt>
provided hooks for trying to prevent unsafe classes from being
unpickled (specifically, a <tt class="docutils literal"><span class="pre">__safe_for_unpickling__</span></tt> attribute), but
none of this code was ever audited and therefore it&#8217;s all been ripped
out in 2.3.  You should not unpickle untrusted data in any version of
Python.</p>
<p>To reduce the pickling overhead for new-style classes, a new interface
for customizing pickling was added using three special methods:
<tt class="docutils literal"><span class="pre">__getstate__()</span></tt>, <tt class="docutils literal"><span class="pre">__setstate__()</span></tt>, and <tt class="docutils literal"><span class="pre">__getnewargs__()</span></tt>.
Consult <strong>PEP 307</strong> for the full semantics  of these methods.</p>
<p>As a way to compress pickles yet further, it&#8217;s now possible to use
integer codes instead of long strings to identify pickled classes. The
Python Software Foundation will maintain a list of standardized codes;
there&#8217;s also a range of codes for private use.  Currently no codes
have been specified.</p>
<p>See also:</p>
<blockquote>
<dl class="docutils">
<dt><strong>PEP 307</strong> - Extensions to the pickle protocol</dt>
<dd>Written and implemented  by Guido van Rossum and Tim Peters.</dd>
</dl>
</blockquote>
</div>
<div class="section" id="extended-slices">
<h2>Extended Slices<a class="headerlink" href="#extended-slices" title="Permalink to this headline">¶</a></h2>
<p>Ever since Python 1.4, the slicing syntax has supported an optional
third &#8220;step&#8221; or &#8220;stride&#8221; argument.  For example, these are all legal
Python syntax: <tt class="docutils literal"><span class="pre">L[1:10:2]</span></tt>, <tt class="docutils literal"><span class="pre">L[:-1:1]</span></tt>, <tt class="docutils literal"><span class="pre">L[::-1]</span></tt>.  This was
added to Python at the request of the developers of Numerical Python,
which uses the third argument extensively.  However, Python&#8217;s built-in
list, tuple, and string sequence types have never supported this
feature, raising a <tt class="docutils literal"><span class="pre">TypeError</span></tt> if you tried it. Michael Hudson
contributed a patch to fix this shortcoming.</p>
<p>For example, you can now easily extract the elements of a list that
have even indexes:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">L</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span>
<span class="go">[0, 2, 4, 6, 8]</span>
</pre></div>
</div>
<p>Negative values also work to make a copy of the same list in reverse
order:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">L</span><span class="p">[::</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span>
<span class="go">[9, 8, 7, 6, 5, 4, 3, 2, 1, 0]</span>
</pre></div>
</div>
<p>This also works for tuples, arrays, and strings:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">=</span><span class="s">&#39;abcd&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span>
<span class="go">&#39;ac&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="p">[::</span><span class="o">-</span><span class="mf">1</span><span class="p">]</span>
<span class="go">&#39;dcba&#39;</span>
</pre></div>
</div>
<p>If you have a mutable sequence such as a list or an array you can
assign to or delete an extended slice, but there are some differences
between assignment to extended and regular slices.  Assignment to a
regular slice can be used to change the length of the sequence:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mf">3</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[0, 1, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[</span><span class="mf">1</span><span class="p">:</span><span class="mf">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">6</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[0, 4, 5, 6]</span>
</pre></div>
</div>
<p>Extended slices aren&#8217;t this flexible.  When assigning to an extended
slice, the list on the right hand side of the statement must contain
the same number of items as the slice it is replacing:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mf">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[0, 1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span>
<span class="go">[0, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[0, 1, -1, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">,</span><span class="mf">2</span><span class="p">]</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">ValueError</span>: <span class="n-Identifier">attempt to assign sequence of size 3 to extended slice of size 2</span>
</pre></div>
</div>
<p>Deletion is more straightforward:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mf">4</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[0, 1, 2, 3]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span>
<span class="go">[0, 2]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">a</span><span class="p">[::</span><span class="mf">2</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">a</span>
<span class="go">[1, 3]</span>
</pre></div>
</div>
<p>One can also now pass slice objects to the <tt class="docutils literal"><span class="pre">__getitem__()</span></tt> methods
of the built-in sequences:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mf">10</span><span class="p">)</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">2</span><span class="p">))</span>
<span class="go">[0, 2, 4]</span>
</pre></div>
</div>
<p>Or use slice objects directly in subscripts:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">range</span><span class="p">(</span><span class="mf">10</span><span class="p">)[</span><span class="nb">slice</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">2</span><span class="p">)]</span>
<span class="go">[0, 2, 4]</span>
</pre></div>
</div>
<p>To simplify implementing sequences that support extended slicing,
slice objects now have a method <tt class="docutils literal"><span class="pre">indices(length)()</span></tt> which, given the
length of a sequence, returns a <tt class="docutils literal"><span class="pre">(start,</span> <span class="pre">stop,</span> <span class="pre">step)</span></tt> tuple that can
be passed directly to <tt class="docutils literal"><span class="pre">range()</span></tt>. <tt class="docutils literal"><span class="pre">indices()</span></tt> handles omitted and
out-of-bounds indices in a manner consistent with regular slices (and
this innocuous phrase hides a welter of confusing details!).  The
method is intended to be used like this:</p>
<blockquote>
<dl class="docutils">
<dt>class FakeSeq:</dt>
<dd><p class="first">...
def calc_item(self, i):</p>
<blockquote>
...</blockquote>
<dl class="last docutils">
<dt>def __getitem__(self, item):</dt>
<dd><dl class="first last docutils">
<dt>if isinstance(item, slice):</dt>
<dd>indices = item.indices(len(self))
return FakeSeq([self.calc_item(i) for i in range(<a href="#id3"><span class="problematic" id="id4">*</span></a>indices)])</dd>
<dt>else:</dt>
<dd>return self.calc_item(i)</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</blockquote>
<p>From this example you can also see that the built-in <tt class="docutils literal"><span class="pre">slice</span></tt> object
is now the type object for the slice type, and is no longer a
function.  This is consistent with Python 2.2, where <tt class="docutils literal"><span class="pre">int</span></tt>, <tt class="docutils literal"><span class="pre">str</span></tt>,
etc., underwent the same change.</p>
</div>
<div class="section" id="other-language-changes">
<h2>Other Language Changes<a class="headerlink" href="#other-language-changes" title="Permalink to this headline">¶</a></h2>
<p>Here are all of the changes that Python 2.3 makes to the core Python
language.</p>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">yield</span></tt> statement is now always a keyword, as described in
section <em>PEP 255: Simple Generators</em> of this document.</p>
</li>
<li><p class="first">A new built-in function <tt class="docutils literal"><span class="pre">enumerate()</span></tt> was added, as described in
section <em>PEP 279: enumerate()</em> of this document.</p>
</li>
<li><p class="first">Two new constants, <tt class="xref docutils literal"><span class="pre">True</span></tt> and <tt class="xref docutils literal"><span class="pre">False</span></tt> were added along with the
built-in <tt class="docutils literal"><span class="pre">bool</span></tt> type, as described in section <em>PEP 285: A Boolean
Type</em> of this document.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">int()</span></tt> type constructor will now return a long integer
instead of raising an <tt class="docutils literal"><span class="pre">OverflowError</span></tt> when a string or floating-
point number is too large to fit into an integer.  This can lead to
the paradoxical result that <tt class="docutils literal"><span class="pre">isinstance(int(expression),</span> <span class="pre">int)</span></tt> is
false, but that seems unlikely to cause problems in practice.</p>
</li>
<li><p class="first">Built-in types now support the extended slicing syntax, as described
in section <em>Extended Slices</em> of this document.</p>
</li>
<li><p class="first">A new built-in function, <tt class="docutils literal"><span class="pre">sum(iterable,</span> <span class="pre">start=0)()</span></tt>,  adds up the
numeric items in the iterable object and returns their sum.
<tt class="docutils literal"><span class="pre">sum()</span></tt> only accepts numbers, meaning that you can&#8217;t use it to
concatenate a bunch of strings. (Contributed by Alex Martelli.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">list.insert(pos,</span> <span class="pre">value)</span></tt> used to  insert <em>value</em> at the front of
the list when <em>pos</em> was negative.  The behaviour has now been
changed to be consistent with slice indexing, so when <em>pos</em> is -1
the value will be inserted before the last element, and so forth.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">list.index(value)</span></tt>, which searches for <em>value</em>  within the list
and returns its index, now takes optional  <em>start</em> and <em>stop</em>
arguments to limit the search to  only part of the list.</p>
</li>
<li><p class="first">Dictionaries have a new method, <tt class="docutils literal"><span class="pre">pop(key[,</span> <span class="pre">*default*])()</span></tt>, that
returns the value corresponding to <em>key</em> and removes that key/value
pair from the dictionary.  If the requested key isn&#8217;t present in the
dictionary, <em>default</em> is returned if it&#8217;s specified and <tt class="docutils literal"><span class="pre">KeyError</span></tt>
raised if it isn&#8217;t.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1</span><span class="p">:</span><span class="mf">2</span><span class="p">}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{1: 2}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mf">4</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">KeyError</span>: <span class="n-Identifier">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
<span class="go">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;stdin&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">KeyError: &#39;pop()</span>: <span class="n-Identifier">dictionary is empty&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{}</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>There&#8217;s also a new class method,  <tt class="docutils literal"><span class="pre">dict.fromkeys(iterable,</span>
<span class="pre">value)()</span></tt>, that creates a dictionary with keys taken from the
supplied iterator <em>iterable</em> and all values set to <em>value</em>,
defaulting to <tt class="xref docutils literal"><span class="pre">None</span></tt>.</p>
<p>(Patches contributed by Raymond Hettinger.)</p>
<p>Also, the <tt class="docutils literal"><span class="pre">dict()</span></tt> constructor now accepts keyword arguments to
simplify creating small dictionaries:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">dict</span><span class="p">(</span><span class="n">red</span><span class="o">=</span><span class="mf">1</span><span class="p">,</span> <span class="n">blue</span><span class="o">=</span><span class="mf">2</span><span class="p">,</span> <span class="n">green</span><span class="o">=</span><span class="mf">3</span><span class="p">,</span> <span class="n">black</span><span class="o">=</span><span class="mf">4</span><span class="p">)</span>
<span class="go">{&#39;blue&#39;: 2, &#39;black&#39;: 4, &#39;green&#39;: 3, &#39;red&#39;: 1}</span>
</pre></div>
</div>
<p>(Contributed by Just van Rossum.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">assert</span></tt> statement no longer checks the <tt class="docutils literal"><span class="pre">__debug__</span></tt> flag, so
you can no longer disable assertions by assigning to <tt class="docutils literal"><span class="pre">__debug__</span></tt>.
Running Python with the <em>-O</em> switch will still generate code that
doesn&#8217;t execute any assertions.</p>
</li>
<li><p class="first">Most type objects are now callable, so you can use them to create
new objects such as functions, classes, and modules.  (This means
that the <tt class="docutils literal"><span class="pre">new</span></tt> module can be deprecated in a future Python
version, because you can now use the type objects available in the
<tt class="docutils literal"><span class="pre">types</span></tt> module.) For example, you can create a new module object
with the following code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">types</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ModuleType</span><span class="p">(</span><span class="s">&#39;abc&#39;</span><span class="p">,</span><span class="s">&#39;docstring&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;module &#39;abc&#39; (built-in)&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">&#39;docstring&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">A new warning, <tt class="docutils literal"><span class="pre">PendingDeprecationWarning</span></tt> was added to indicate
features which are in the process of being deprecated.  The warning
will <em>not</em> be printed by default.  To check for use of features that
will be deprecated in the future, supply
<em>-Walways::PendingDeprecationWarning::</em> on the command line or use
<tt class="docutils literal"><span class="pre">warnings.filterwarnings()</span></tt>.</p>
</li>
<li><p class="first">The process of deprecating string-based exceptions, as in <tt class="docutils literal"><span class="pre">raise</span>
<span class="pre">&quot;Error</span> <span class="pre">occurred&quot;</span></tt>, has begun.  Raising a string will now trigger
<tt class="docutils literal"><span class="pre">PendingDeprecationWarning</span></tt>.</p>
</li>
<li><p class="first">Using <tt class="xref docutils literal"><span class="pre">None</span></tt> as a variable name will now result in a
<tt class="docutils literal"><span class="pre">SyntaxWarning</span></tt> warning.  In a future version of Python, <tt class="xref docutils literal"><span class="pre">None</span></tt>
may finally become a keyword.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">xreadlines()</span></tt> method of file objects, introduced in Python
2.1, is no longer necessary because files now behave as their own
iterator. <tt class="docutils literal"><span class="pre">xreadlines()</span></tt> was originally introduced as a faster way
to loop over all the lines in a file, but now you can simply write
<tt class="docutils literal"><span class="pre">for</span> <span class="pre">line</span> <span class="pre">in</span> <span class="pre">file_obj</span></tt>. File objects also have a new read-only
<tt class="docutils literal"><span class="pre">encoding</span></tt> attribute that gives the encoding used by the file;
Unicode strings written to the file will be automatically  converted
to bytes using the given encoding.</p>
</li>
<li><p class="first">The method resolution order used by new-style classes has changed,
though you&#8217;ll only notice the difference if you have a really
complicated inheritance hierarchy.  Classic classes are unaffected
by this change.  Python 2.2 originally used a topological sort of a
class&#8217;s ancestors, but 2.3 now uses the C3 algorithm as described in
the paper &#8220;A Monotonic Superclass Linearization for Dylan&#8221;. To
understand the motivation for this change,  read Michele Simionato&#8217;s
article &#8220;Python 2.3 Method Resolution Order&#8221;, or read the thread on
python-dev starting with the message at
<a class="reference external" href="http://mail.python.org/pipermail/python">http://mail.python.org/pipermail/python</a>-
dev/2002-October/029035.html. Samuele Pedroni first pointed out the
problem and also implemented the fix by coding the C3 algorithm.</p>
</li>
<li><p class="first">Python runs multithreaded programs by switching between threads
after executing N bytecodes.  The default value for N has been
increased from 10 to 100 bytecodes, speeding up single-threaded
applications by reducing the switching overhead.  Some multithreaded
applications may suffer slower response time, but that&#8217;s easily
fixed by setting the limit back to a lower number using
<tt class="docutils literal"><span class="pre">sys.setcheckinterval(N)()</span></tt>. The limit can be retrieved with the
new <tt class="docutils literal"><span class="pre">sys.getcheckinterval()</span></tt> function.</p>
</li>
<li><p class="first">One minor but far-reaching change is that the names of extension
types defined by the modules included with Python now contain the
module and a <tt class="docutils literal"><span class="pre">'.'</span></tt> in front of the type name.  For example, in
Python 2.2, if you created a socket and printed its <tt class="docutils literal"><span class="pre">__class__</span></tt>,
you&#8217;d get this output:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">__class__</span>
<span class="go">&lt;type &#39;socket&#39;&gt;</span>
</pre></div>
</div>
<p>In 2.3, you get this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">__class__</span>
<span class="go">&lt;type &#39;_socket.socket&#39;&gt;</span>
</pre></div>
</div>
</li>
<li><p class="first">One of the noted incompatibilities between old- and new-style
classes has been removed: you can now assign to the <tt class="docutils literal"><span class="pre">__name__</span></tt> and
<tt class="docutils literal"><span class="pre">__bases__</span></tt> attributes of new-style classes.  There are some
restrictions on what can be assigned to <tt class="docutils literal"><span class="pre">__bases__</span></tt> along the
lines of those relating to assigning to an instance&#8217;s <tt class="docutils literal"><span class="pre">__class__</span></tt>
attribute.</p>
</li>
</ul>
<div class="section" id="string-changes">
<h3>String Changes<a class="headerlink" href="#string-changes" title="Permalink to this headline">¶</a></h3>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">in</span></tt> operator now works differently for strings. Previously,
when evaluating <tt class="docutils literal"><span class="pre">X</span> <span class="pre">in</span> <span class="pre">Y</span></tt> where <em>X</em> and <em>Y</em> are strings, <em>X</em> could
only be a single character. That&#8217;s now changed; <em>X</em> can be a string
of any length, and <tt class="docutils literal"><span class="pre">X</span> <span class="pre">in</span> <span class="pre">Y</span></tt> will return <tt class="xref docutils literal"><span class="pre">True</span></tt> if <em>X</em> is a
substring of <em>Y</em>.  If <em>X</em> is the empty string, the result is always
<tt class="xref docutils literal"><span class="pre">True</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;ab&#39;</span> <span class="ow">in</span> <span class="s">&#39;abcd&#39;</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;ad&#39;</span> <span class="ow">in</span> <span class="s">&#39;abcd&#39;</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&#39;</span> <span class="ow">in</span> <span class="s">&#39;abcd&#39;</span>
<span class="go">True</span>
</pre></div>
</div>
<p>Note that this doesn&#8217;t tell you where the substring starts; if you
need that information, use the <tt class="docutils literal"><span class="pre">find()</span></tt> string method.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">strip()</span></tt>, <tt class="docutils literal"><span class="pre">lstrip()</span></tt>, and <tt class="docutils literal"><span class="pre">rstrip()</span></tt> string methods now
have an optional argument for specifying the characters to strip.
The default is still to remove all whitespace characters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;   abc &#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
<span class="go">&#39;abc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&gt;&lt;&gt;&lt;abc&lt;&gt;&lt;&gt;&lt;&gt;&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&lt;&gt;&#39;</span><span class="p">)</span>
<span class="go">&#39;abc&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;&gt;&lt;&gt;&lt;abc&lt;&gt;&lt;&gt;&lt;&gt;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;&lt;&gt;&#39;</span><span class="p">)</span>
<span class="go">&#39;abc&lt;&gt;&lt;&gt;&lt;&gt;\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">u&#39;</span><span class="se">\u4000\u4001</span><span class="s">abc</span><span class="se">\u4000</span><span class="s">&#39;</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">u&#39;</span><span class="se">\u4000</span><span class="s">&#39;</span><span class="p">)</span>
<span class="go">u&#39;\u4001abc&#39;</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>(Suggested by Simon Brunning and implemented by Walter Dörwald.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">startswith()</span></tt> and <tt class="docutils literal"><span class="pre">endswith()</span></tt> string methods now accept
negative numbers for the <em>start</em> and <em>end</em> parameters.</p>
</li>
<li><p class="first">Another new string method is <tt class="docutils literal"><span class="pre">zfill()</span></tt>, originally a function in
the <tt class="docutils literal"><span class="pre">string</span></tt> module.  <tt class="docutils literal"><span class="pre">zfill()</span></tt> pads a numeric string with zeros
on the left until it&#8217;s the specified width. Note that the <tt class="docutils literal"><span class="pre">%</span></tt>
operator is still more flexible and powerful than <tt class="docutils literal"><span class="pre">zfill()</span></tt>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;45&#39;</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mf">4</span><span class="p">)</span>
<span class="go">&#39;0045&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;12345&#39;</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mf">4</span><span class="p">)</span>
<span class="go">&#39;12345&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;goofy&#39;</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mf">6</span><span class="p">)</span>
<span class="go">&#39;0goofy&#39;</span>
</pre></div>
</div>
<p>(Contributed by Walter Dörwald.)</p>
</li>
<li><p class="first">A new type object, <tt class="docutils literal"><span class="pre">basestring</span></tt>, has been added. Both 8-bit
strings and Unicode strings inherit from this type, so
<tt class="docutils literal"><span class="pre">isinstance(obj,</span> <span class="pre">basestring)</span></tt> will return <tt class="xref docutils literal"><span class="pre">True</span></tt> for either kind
of string.  It&#8217;s a completely abstract type, so you can&#8217;t create
<tt class="docutils literal"><span class="pre">basestring</span></tt> instances.</p>
</li>
<li><p class="first">Interned strings are no longer immortal and will now be garbage-
collected in the usual way when the only reference to them is from
the internal dictionary of interned strings.  (Implemented by Oren
Tirosh.)</p>
</li>
</ul>
</div>
<div class="section" id="optimizations">
<h3>Optimizations<a class="headerlink" href="#optimizations" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>The creation of new-style class instances has been made much faster;
they&#8217;re now faster than classic classes!</li>
<li>The <tt class="docutils literal"><span class="pre">sort()</span></tt> method of list objects has been extensively rewritten
by Tim Peters, and the implementation is significantly faster.</li>
<li>Multiplication of large long integers is now much faster thanks to
an implementation of Karatsuba multiplication, an algorithm that
scales better than the O(n*n) required for the grade-school
multiplication algorithm.  (Original patch by Christopher A. Craig,
and significantly reworked by Tim Peters.)</li>
<li>The <tt class="docutils literal"><span class="pre">SET_LINENO</span></tt> opcode is now gone.  This may provide a small
speed increase, depending on your compiler&#8217;s idiosyncrasies. See
section <em>Other Changes and Fixes</em> for a longer explanation. (Removed
by Michael Hudson.)</li>
<li><tt class="docutils literal"><span class="pre">xrange()</span></tt> objects now have their own iterator, making <tt class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span>
<span class="pre">xrange(n)</span></tt> slightly faster than <tt class="docutils literal"><span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(n)</span></tt>.  (Patch by
Raymond Hettinger.)</li>
<li>A number of small rearrangements have been made in various hotspots
to improve performance, such as inlining a function or removing some
code.  (Implemented mostly by GvR, but lots of people have
contributed single changes.)</li>
</ul>
<p>The net result of the 2.3 optimizations is that Python 2.3 runs the
pystone benchmark around 25% faster than Python 2.2.</p>
</div>
</div>
<div class="section" id="new-improved-and-deprecated-modules">
<h2>New, Improved, and Deprecated Modules<a class="headerlink" href="#new-improved-and-deprecated-modules" title="Permalink to this headline">¶</a></h2>
<p>As usual, Python&#8217;s standard library received a number of enhancements
and bug fixes.  Here&#8217;s a partial list of the most notable changes,
sorted alphabetically by module name. Consult the <tt class="docutils literal"><span class="pre">Misc/NEWS</span></tt> file
in the source tree for a more complete list of changes, or look
through the CVS logs for all the details.</p>
<ul>
<li><p class="first">The <tt class="docutils literal"><span class="pre">array</span></tt> module now supports arrays of Unicode characters using
the <tt class="docutils literal"><span class="pre">'u'</span></tt> format character.  Arrays also now support using the
<tt class="docutils literal"><span class="pre">+=</span></tt> assignment operator to add another array&#8217;s contents, and the
<tt class="docutils literal"><span class="pre">*=</span></tt> assignment operator to repeat an array. (Contributed by Jason
Orendorff.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">bsddb</span></tt> module has been replaced by version 4.1.6 of the
PyBSDDB package, providing a more complete interface to the
transactional features of the BerkeleyDB library.</p>
<p>The old version of the module has been renamed to  <tt class="docutils literal"><span class="pre">bsddb185</span></tt> and
is no longer built automatically; you&#8217;ll  have to edit
<tt class="docutils literal"><span class="pre">Modules/Setup</span></tt> to enable it.  Note that the new <tt class="docutils literal"><span class="pre">bsddb</span></tt> package
is intended to be compatible with the  old module, so be sure to
file bugs if you discover any incompatibilities. When upgrading to
Python 2.3, if the new interpreter is compiled with a new version of
the underlying BerkeleyDB library, you will almost certainly have to
convert your database files to the new version.  You can do this
fairly easily with the new scripts <tt class="docutils literal"><span class="pre">db2pickle.py</span></tt> and
<tt class="docutils literal"><span class="pre">pickle2db.py</span></tt> which you will find in the distribution&#8217;s
<tt class="docutils literal"><span class="pre">Tools/scripts</span></tt> directory.  If you&#8217;ve already been using the
PyBSDDB package and importing it as <tt class="docutils literal"><span class="pre">bsddb3</span></tt>, you will have to
change your <tt class="docutils literal"><span class="pre">import</span></tt> statements to import it as <tt class="docutils literal"><span class="pre">bsddb</span></tt>.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">bz2</span></tt> module is an interface to the bz2 data compression
library. bz2-compressed data is usually smaller than  corresponding
<tt class="docutils literal"><span class="pre">zlib</span></tt>-compressed data. (Contributed by Gustavo Niemeyer.)</p>
</li>
<li><p class="first">A set of standard date/time types has been added in the new
<tt class="docutils literal"><span class="pre">datetime</span></tt> module.  See the following section for more details.</p>
</li>
<li><p class="first">The Distutils <tt class="docutils literal"><span class="pre">Extension</span></tt> class now supports an extra constructor
argument named <em>depends</em> for listing additional source files that an
extension depends on.  This lets Distutils recompile the module if
any of the dependency files are modified.  For example, if
<tt class="docutils literal"><span class="pre">sampmodule.c</span></tt> includes the header file <tt class="docutils literal"><span class="pre">sample.h</span></tt>, you would
create the <tt class="docutils literal"><span class="pre">Extension</span></tt> object like this:</p>
<blockquote>
<dl class="docutils">
<dt>ext = Extension(&#8220;samp&#8221;,</dt>
<dd><p class="first last">sources=[&#8220;sampmodule.c&#8221;],
depends=[&#8220;sample.h&#8221;])</p>
</dd>
</dl>
</blockquote>
<p>Modifying <tt class="docutils literal"><span class="pre">sample.h</span></tt> would then cause the module to be recompiled.
(Contributed by Jeremy Hylton.)</p>
</li>
<li><p class="first">Other minor changes to Distutils: it now checks for the <strong>CC</strong>,
<strong>CFLAGS</strong>, <strong>CPP</strong>, <strong>LDFLAGS</strong>, and <strong>CPPFLAGS</strong> environment
variables, using them to override the settings in Python&#8217;s
configuration (contributed by Robert Weber).</p>
</li>
<li><p class="first">Previously the <tt class="docutils literal"><span class="pre">doctest</span></tt> module would only search the docstrings
of public methods and functions for test cases, but it now also
examines private ones as well.  The <tt class="docutils literal"><span class="pre">DocTestSuite(()</span></tt> function
creates a <tt class="docutils literal"><span class="pre">unittest.TestSuite</span></tt> object from a set of <tt class="docutils literal"><span class="pre">doctest</span></tt>
tests.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">gc.get_referents(object)()</span></tt> function returns a list of
all the objects referenced by <em>object</em>.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">getopt</span></tt> module gained a new function, <tt class="docutils literal"><span class="pre">gnu_getopt()</span></tt>, that
supports the same arguments as the existing <tt class="docutils literal"><span class="pre">getopt()</span></tt> function
but uses GNU-style scanning mode. The existing <tt class="docutils literal"><span class="pre">getopt()</span></tt> stops
processing options as soon as a non-option argument is encountered,
but in GNU-style mode processing continues, meaning that options and
arguments can be mixed.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">getopt</span><span class="o">.</span><span class="n">getopt</span><span class="p">([</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">],</span> <span class="s">&#39;f:v&#39;</span><span class="p">)</span>
<span class="go">([(&#39;-f&#39;, &#39;filename&#39;)], [&#39;output&#39;, &#39;-v&#39;])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getopt</span><span class="o">.</span><span class="n">gnu_getopt</span><span class="p">([</span><span class="s">&#39;-f&#39;</span><span class="p">,</span> <span class="s">&#39;filename&#39;</span><span class="p">,</span> <span class="s">&#39;output&#39;</span><span class="p">,</span> <span class="s">&#39;-v&#39;</span><span class="p">],</span> <span class="s">&#39;f:v&#39;</span><span class="p">)</span>
<span class="go">([(&#39;-f&#39;, &#39;filename&#39;), (&#39;-v&#39;, &#39;&#39;)], [&#39;output&#39;])</span>
</pre></div>
</div>
<p>(Contributed by Peter Åstrand.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">grp</span></tt>, <tt class="docutils literal"><span class="pre">pwd</span></tt>, and <tt class="docutils literal"><span class="pre">resource</span></tt> modules now return enhanced
tuples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">grp</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span> <span class="o">=</span> <span class="n">grp</span><span class="o">.</span><span class="n">getgrnam</span><span class="p">(</span><span class="s">&#39;amk&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">g</span><span class="o">.</span><span class="n">gr_name</span><span class="p">,</span> <span class="n">g</span><span class="o">.</span><span class="n">gr_gid</span>
<span class="go">(&#39;amk&#39;, 500)</span>
</pre></div>
</div>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">gzip</span></tt> module can now handle files exceeding 2 GiB.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">heapq</span></tt> module contains an implementation of a heap queue
algorithm.  A heap is an array-like data structure that keeps items
in a partially sorted order such that, for every index <em>k</em>,
<tt class="docutils literal"><span class="pre">heap[k]</span> <span class="pre">&lt;=</span> <span class="pre">heap[2*k+1]</span></tt> and <tt class="docutils literal"><span class="pre">heap[k]</span> <span class="pre">&lt;=</span> <span class="pre">heap[2*k+2]</span></tt>.  This
makes it quick to remove the smallest item, and inserting a new item
while maintaining the heap property is O(lg n).  (See
<a class="reference external" href="http://www.nist.gov/dads/HTML/priorityque.html">http://www.nist.gov/dads/HTML/priorityque.html</a> for more information
about the priority queue data structure.)</p>
<p>The <tt class="docutils literal"><span class="pre">heapq</span></tt> module provides <tt class="docutils literal"><span class="pre">heappush()</span></tt> and <tt class="docutils literal"><span class="pre">heappop()</span></tt>
functions for adding and removing items while maintaining the heap
property on top of some other mutable Python sequence type.  Here&#8217;s
an example that uses a Python list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">heapq</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heap</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">3</span><span class="p">,</span> <span class="mf">7</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">11</span><span class="p">,</span> <span class="mf">1</span><span class="p">]:</span>
<span class="gp">... </span>   <span class="n">heapq</span><span class="o">.</span><span class="n">heappush</span><span class="p">(</span><span class="n">heap</span><span class="p">,</span> <span class="n">item</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heap</span>
<span class="go">[1, 3, 5, 11, 7]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heapq</span><span class="o">.</span><span class="n">heappop</span><span class="p">(</span><span class="n">heap</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">heap</span>
<span class="go">[5, 7, 11]</span>
</pre></div>
</div>
<p>(Contributed by Kevin O&#8217;Connor.)</p>
</li>
<li><p class="first">The IDLE integrated development environment has been updated using
the code from the IDLEfork project (<a class="reference external" href="http://idlefork.sf.net">http://idlefork.sf.net</a>).  The
most notable feature is that the code being developed is now
executed in a subprocess, meaning that there&#8217;s no longer any need
for manual <tt class="docutils literal"><span class="pre">reload()</span></tt> operations. IDLE&#8217;s core code has been
incorporated into the standard library as the <tt class="docutils literal"><span class="pre">idlelib</span></tt> package.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">imaplib</span></tt> module now supports IMAP over SSL. (Contributed by
Piers Lauder and Tino Lange.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">itertools</span></tt> contains a number of useful functions for use with
iterators, inspired by various functions provided by the ML and
Haskell languages.  For example, <tt class="docutils literal"><span class="pre">itertools.ifilter(predicate,</span>
<span class="pre">iterator)</span></tt> returns all elements in the iterator for which the
function <tt class="docutils literal"><span class="pre">predicate()</span></tt> returns <tt class="xref docutils literal"><span class="pre">True</span></tt>, and
<tt class="docutils literal"><span class="pre">itertools.repeat(obj,</span> <span class="pre">N)</span></tt> returns <tt class="docutils literal"><span class="pre">obj</span></tt> <em>N</em> times. There are a
number of other functions in the module; see the package&#8217;s reference
documentation for details. (Contributed by Raymond Hettinger.)</p>
</li>
<li><p class="first">Two new functions in the <tt class="docutils literal"><span class="pre">math</span></tt> module, <tt class="docutils literal"><span class="pre">degrees(rads)()</span></tt> and
<tt class="docutils literal"><span class="pre">radians(degs)()</span></tt>, convert between radians and degrees.  Other
functions in the <tt class="docutils literal"><span class="pre">math</span></tt> module such as <tt class="docutils literal"><span class="pre">math.sin()</span></tt> and
<tt class="docutils literal"><span class="pre">math.cos()</span></tt> have always required input values measured in
radians.  Also, an optional <em>base</em> argument was added to
<tt class="docutils literal"><span class="pre">math.log()</span></tt> to make it easier to compute logarithms for bases
other than <tt class="docutils literal"><span class="pre">e</span></tt> and <tt class="docutils literal"><span class="pre">10</span></tt>.  (Contributed by Raymond Hettinger.)</p>
</li>
<li><p class="first">Several new POSIX functions (<tt class="docutils literal"><span class="pre">getpgid()</span></tt>, <tt class="docutils literal"><span class="pre">killpg()</span></tt>,
<tt class="docutils literal"><span class="pre">lchown()</span></tt>, <tt class="docutils literal"><span class="pre">loadavg()</span></tt>, <tt class="docutils literal"><span class="pre">major()</span></tt>, <tt class="docutils literal"><span class="pre">makedev()</span></tt>,
<tt class="docutils literal"><span class="pre">minor()</span></tt>, and <tt class="docutils literal"><span class="pre">mknod()</span></tt>) were added to the <tt class="docutils literal"><span class="pre">posix</span></tt> module
that underlies the <tt class="docutils literal"><span class="pre">os</span></tt> module. (Contributed by Gustavo Niemeyer,
Geert Jansen, and Denis S. Otkidach.)</p>
</li>
<li><p class="first">In the <tt class="docutils literal"><span class="pre">os</span></tt> module, the <tt class="docutils literal"><span class="pre">*stat()</span></tt> family of functions can now
report fractions of a second in a timestamp.  Such time stamps are
represented as floats, similar to the value returned by
<tt class="docutils literal"><span class="pre">time.time()</span></tt>.</p>
<p>During testing, it was found that some applications will break if
time stamps are floats.  For compatibility, when using the tuple
interface of the <tt class="docutils literal"><span class="pre">stat_result</span></tt> time stamps will be represented as
integers. When using named fields (a feature first introduced in
Python 2.2), time stamps are still represented as integers, unless
<tt class="docutils literal"><span class="pre">os.stat_float_times()</span></tt> is invoked to enable float return values:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/tmp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
<span class="go">1034791200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">stat_float_times</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="s">&quot;/tmp&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span>
<span class="go">1034791200.6335014</span>
</pre></div>
</div>
<p>In Python 2.4, the default will change to always returning floats.</p>
<p>Application developers should enable this feature only if all their
libraries work properly when confronted with floating point time
stamps, or if they use the tuple API. If used, the feature should be
activated on an application level instead of trying to enable it on
a per-use basis.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">optparse</span></tt> module contains a new parser for command-line
arguments that can convert option values to a particular Python type
and will automatically generate a usage message.  See the following
section for  more details.</p>
</li>
<li><p class="first">The old and never-documented <tt class="docutils literal"><span class="pre">linuxaudiodev</span></tt> module has been
deprecated, and a new version named <tt class="docutils literal"><span class="pre">ossaudiodev</span></tt> has been added.
The module was renamed because the OSS sound drivers can be used on
platforms other than Linux, and the interface has also been tidied
and brought up to date in various ways. (Contributed by Greg Ward
and Nicholas FitzRoy-Dale.)</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">platform</span></tt> module contains a number of functions that try
to determine various properties of the platform you&#8217;re running on.
There are functions for getting the architecture, CPU type, the
Windows OS version, and even the Linux distribution version.
(Contributed by Marc-André Lemburg.)</p>
</li>
<li><p class="first">The parser objects provided by the <tt class="docutils literal"><span class="pre">pyexpat</span></tt> module can now
optionally buffer character data, resulting in fewer calls to your
character data handler and therefore faster performance.  Setting
the parser object&#8217;s <tt class="docutils literal"><span class="pre">buffer_text</span></tt> attribute to <tt class="xref docutils literal"><span class="pre">True</span></tt> will
enable buffering.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">sample(population,</span> <span class="pre">k)()</span></tt> function was added to the <tt class="docutils literal"><span class="pre">random</span></tt>
module.  <em>population</em> is a sequence or <tt class="docutils literal"><span class="pre">xrange</span></tt> object containing
the elements of a population, and <tt class="docutils literal"><span class="pre">sample()</span></tt> chooses <em>k</em> elements
from the population without replacing chosen elements.  <em>k</em> can be
any value up to <tt class="docutils literal"><span class="pre">len(population)</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">days</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Mo&#39;</span><span class="p">,</span> <span class="s">&#39;Tu&#39;</span><span class="p">,</span> <span class="s">&#39;We&#39;</span><span class="p">,</span> <span class="s">&#39;Th&#39;</span><span class="p">,</span> <span class="s">&#39;Fr&#39;</span><span class="p">,</span> <span class="s">&#39;St&#39;</span><span class="p">,</span> <span class="s">&#39;Sn&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="mf">3</span><span class="p">)</span>      <span class="c"># Choose 3 elements</span>
<span class="go">[&#39;St&#39;, &#39;Sn&#39;, &#39;Th&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="mf">7</span><span class="p">)</span>      <span class="c"># Choose 7 elements</span>
<span class="go">[&#39;Tu&#39;, &#39;Th&#39;, &#39;Mo&#39;, &#39;We&#39;, &#39;St&#39;, &#39;Fr&#39;, &#39;Sn&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="mf">7</span><span class="p">)</span>      <span class="c"># Choose 7 again</span>
<span class="go">[&#39;We&#39;, &#39;Mo&#39;, &#39;Sn&#39;, &#39;Fr&#39;, &#39;Tu&#39;, &#39;St&#39;, &#39;Th&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">days</span><span class="p">,</span> <span class="mf">8</span><span class="p">)</span>      <span class="c"># Can&#39;t choose eight</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
  File <span class="nb">&quot;random.py&quot;</span>, line <span class="m">414</span>, in <span class="n-Identifier">sample</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&quot;sample larger than population&quot;</span>
<span class="nc">ValueError</span>: <span class="n-Identifier">sample larger than population</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">xrange</span><span class="p">(</span><span class="mf">1</span><span class="p">,</span><span class="mf">10000</span><span class="p">,</span><span class="mf">2</span><span class="p">),</span> <span class="mf">10</span><span class="p">)</span>   <span class="c"># Choose ten odd nos. under 10000</span>
<span class="go">[3407, 3805, 1505, 7023, 2401, 2267, 9733, 3151, 8083, 9195]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">random</span></tt> module now uses a new algorithm, the Mersenne
Twister, implemented in C.  It&#8217;s faster and more extensively studied
than the previous algorithm.</p>
<p>(All changes contributed by Raymond Hettinger.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">readline</span></tt> module also gained a number of new functions:
<tt class="docutils literal"><span class="pre">get_history_item()</span></tt>, <tt class="docutils literal"><span class="pre">get_current_history_length()</span></tt>, and
<tt class="docutils literal"><span class="pre">redisplay()</span></tt>.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">rexec</span></tt> and <tt class="docutils literal"><span class="pre">Bastion</span></tt> modules have been declared dead, and
attempts to import them will fail with a <tt class="docutils literal"><span class="pre">RuntimeError</span></tt>.  New-
style classes provide new ways to break out of the restricted
execution environment provided by <tt class="docutils literal"><span class="pre">rexec</span></tt>, and no one has interest
in fixing them or time to do so.  If you have applications using
<tt class="docutils literal"><span class="pre">rexec</span></tt>, rewrite them to use something else.</p>
<p>(Sticking with Python 2.2 or 2.1 will not make your applications any
safer because there are known bugs in the <tt class="docutils literal"><span class="pre">rexec</span></tt> module in those
versions.  To repeat: if you&#8217;re using <tt class="docutils literal"><span class="pre">rexec</span></tt>, stop using it
immediately.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">rotor</span></tt> module has been deprecated because the  algorithm it
uses for encryption is not believed to be secure.  If you need
encryption, use one of the several AES Python modules that are
available separately.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">shutil</span></tt> module gained a <tt class="docutils literal"><span class="pre">move(src,</span> <span class="pre">dest)()</span></tt> function that
recursively moves a file or directory to a new location.</p>
</li>
<li><p class="first">Support for more advanced POSIX signal handling was added to the
<tt class="docutils literal"><span class="pre">signal</span></tt> but then removed again as it proved impossible to make it
work reliably across platforms.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">socket</span></tt> module now supports timeouts.  You can call the
<tt class="docutils literal"><span class="pre">settimeout(t)()</span></tt> method on a socket object to set a timeout of
<em>t</em> seconds. Subsequent socket operations that take longer than <em>t</em>
seconds to complete will abort and raise a <tt class="docutils literal"><span class="pre">socket.timeout</span></tt>
exception.</p>
<p>The original timeout implementation was by Tim O&#8217;Malley.  Michael
Gilfix integrated it into the Python <tt class="docutils literal"><span class="pre">socket</span></tt> module and
shepherded it through a lengthy review.  After the code was checked
in, Guido van Rossum rewrote parts of it.  (This is a good example
of a collaborative development process in action.)</p>
</li>
<li><p class="first">On Windows, the <tt class="docutils literal"><span class="pre">socket</span></tt> module now ships with Secure  Sockets
Layer (SSL) support.</p>
</li>
<li><p class="first">The value of the C <tt class="docutils literal"><span class="pre">PYTHON_API_VERSION</span></tt> macro is now exposed at
the Python level as <tt class="docutils literal"><span class="pre">sys.api_version</span></tt>.  The current exception can
be cleared by calling the new <tt class="docutils literal"><span class="pre">sys.exc_clear()</span></tt> function.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">tarfile</span></tt> module  allows reading from and writing to
<strong>tar</strong>-format archive files. (Contributed by Lars Gustäbel.)</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">textwrap</span></tt> module contains functions for wrapping strings
containing paragraphs of text.  The <tt class="docutils literal"><span class="pre">wrap(text,</span> <span class="pre">width)()</span></tt> function
takes a string and returns a list containing the text split into
lines of no more than the chosen width.  The <tt class="docutils literal"><span class="pre">fill(text,</span> <span class="pre">width)()</span></tt>
function returns a single string, reformatted to fit into lines no
longer than the chosen width. (As you can guess, <tt class="docutils literal"><span class="pre">fill()</span></tt> is built
on top of <tt class="docutils literal"><span class="pre">wrap()</span></tt>.  For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">textwrap</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">paragraph</span> <span class="o">=</span> <span class="s">&quot;Not a whit, we defy augury: ... more text ...&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">paragraph</span><span class="p">,</span> <span class="mf">60</span><span class="p">)</span>
<span class="go">[&quot;Not a whit, we defy augury: there&#39;s a special providence in&quot;,</span>
<span class="go"> &quot;the fall of a sparrow. If it be now, &#39;tis not to come; if it&quot;,</span>
<span class="go"> ...]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">paragraph</span><span class="p">,</span> <span class="mf">35</span><span class="p">)</span>
<span class="go">Not a whit, we defy augury: there&#39;s</span>
<span class="go">a special providence in the fall of</span>
<span class="go">a sparrow. If it be now, &#39;tis not</span>
<span class="go">to come; if it be not to come, it</span>
<span class="go">will be now; if it be not now, yet</span>
<span class="go">it will come: the readiness is all.</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>The module also contains a <tt class="docutils literal"><span class="pre">TextWrapper</span></tt> class that actually
implements the text wrapping strategy.   Both the <tt class="docutils literal"><span class="pre">TextWrapper</span></tt>
class and the <tt class="docutils literal"><span class="pre">wrap()</span></tt> and <tt class="docutils literal"><span class="pre">fill()</span></tt> functions support a number
of additional keyword arguments for fine-tuning the formatting;
consult the module&#8217;s documentation for details. (Contributed by Greg
Ward.)</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">thread</span></tt> and <tt class="docutils literal"><span class="pre">threading</span></tt> modules now have companion modules,
<tt class="docutils literal"><span class="pre">dummy_thread</span></tt> and <tt class="docutils literal"><span class="pre">dummy_threading</span></tt>, that provide a do-nothing
implementation of the <tt class="docutils literal"><span class="pre">thread</span></tt> module&#8217;s interface for platforms
where threads are not supported.  The intention is to simplify
thread-aware modules (ones that <em>don&#8217;t</em> rely on threads to run) by
putting the following code at the top:</p>
<blockquote>
<dl class="docutils">
<dt>try:</dt>
<dd><p class="first last">import threading as _threading</p>
</dd>
<dt>except ImportError:</dt>
<dd><p class="first last">import dummy_threading as _threading</p>
</dd>
</dl>
</blockquote>
<p>In this example, <tt class="docutils literal"><span class="pre">_threading</span></tt> is used as the module name to make
it clear that the module being used is not necessarily the actual
<tt class="docutils literal"><span class="pre">threading</span></tt> module. Code can call functions and use classes in
<tt class="docutils literal"><span class="pre">_threading</span></tt> whether or not threads are supported, avoiding an
<tt class="docutils literal"><span class="pre">if</span></tt> statement and making the code slightly clearer.  This module
will not magically make multithreaded code run without threads; code
that waits for another thread to return or to do something will
simply hang forever.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">time</span></tt> module&#8217;s <tt class="docutils literal"><span class="pre">strptime()</span></tt> function has long been an
annoyance because it uses the platform C library&#8217;s <tt class="docutils literal"><span class="pre">strptime()</span></tt>
implementation, and different platforms sometimes have odd bugs.
Brett Cannon contributed a portable implementation that&#8217;s written in
pure Python and should behave identically on all platforms.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">timeit</span></tt> module helps measure how long snippets of Python
code take to execute.  The <tt class="docutils literal"><span class="pre">timeit.py</span></tt> file can be run directly
from the command line, or the module&#8217;s <tt class="docutils literal"><span class="pre">Timer</span></tt> class can be
imported and used directly.  Here&#8217;s a short example that figures out
whether it&#8217;s faster to convert an 8-bit string to Unicode by
appending an empty Unicode string to it or by using the
<tt class="docutils literal"><span class="pre">unicode()</span></tt> function:</p>
<blockquote>
<p>import timeit</p>
<p>timer1 = timeit.Timer(&#8216;unicode(&#8220;abc&#8221;)&#8217;)
timer2 = timeit.Timer(&#8216;&#8220;abc&#8221; + u&#8221;&#8220;&#8217;)</p>
<p># Run three trials
print timer1.repeat(repeat=3, number=100000)
print timer2.repeat(repeat=3, number=100000)</p>
<p># On my laptop this outputs:
# [0.36831796169281006, 0.37441694736480713, 0.35304892063140869]
# [0.17574405670166016, 0.18193507194519043, 0.17565798759460449]</p>
</blockquote>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">Tix</span></tt> module has received various bug fixes and updates for
the current version of the Tix package.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">Tkinter</span></tt> module now works with a thread-enabled  version of
Tcl. Tcl&#8217;s threading model requires that widgets only be accessed
from the thread in which they&#8217;re created; accesses from another
thread can cause Tcl to panic.  For certain Tcl interfaces,
<tt class="docutils literal"><span class="pre">Tkinter</span></tt> will now automatically avoid this  when a widget is
accessed from a different thread by marshalling a command, passing
it to the correct thread, and waiting for the results.  Other
interfaces can&#8217;t be handled automatically but <tt class="docutils literal"><span class="pre">Tkinter</span></tt> will now
raise an exception on such an access so that you can at least find
out about the problem.  See <a class="reference external" href="http://mail.python.org/pipermail/python">http://mail.python.org/pipermail/python</a>-
dev/2002-December/031107.html for a more detailed explanation of
this change.  (Implemented by Martin von Löwis.)</p>
</li>
<li><p class="first">Calling Tcl methods through <tt class="docutils literal"><span class="pre">_tkinter</span></tt> no longer  returns only
strings. Instead, if Tcl returns other objects those objects are
converted to their Python equivalent, if one exists, or wrapped with
a <tt class="docutils literal"><span class="pre">_tkinter.Tcl_Obj</span></tt> object if no Python equivalent exists. This
behavior can be controlled through the <tt class="docutils literal"><span class="pre">wantobjects()</span></tt> method of
<tt class="docutils literal"><span class="pre">tkapp</span></tt> objects.</p>
<p>When using <tt class="docutils literal"><span class="pre">_tkinter</span></tt> through the <tt class="docutils literal"><span class="pre">Tkinter</span></tt> module (as most
Tkinter applications will), this feature is always activated. It
should not cause compatibility problems, since Tkinter would always
convert string results to Python types where possible.</p>
<p>If any incompatibilities are found, the old behavior can be restored
by setting the <tt class="docutils literal"><span class="pre">wantobjects</span></tt> variable in the <tt class="docutils literal"><span class="pre">Tkinter</span></tt> module to
false before creating the first <tt class="docutils literal"><span class="pre">tkapp</span></tt> object.</p>
<blockquote>
<p>import Tkinter
Tkinter.wantobjects = 0</p>
</blockquote>
<p>Any breakage caused by this change should be reported as a bug.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">UserDict</span></tt> module has a new <tt class="docutils literal"><span class="pre">DictMixin</span></tt> class which defines
all dictionary methods for classes that already have a minimum
mapping interface.  This greatly simplifies writing classes that
need to be substitutable for dictionaries, such as the classes in
the <tt class="docutils literal"><span class="pre">shelve</span></tt> module.</p>
<p>Adding the mix-in as a superclass provides the full dictionary
interface whenever the class defines <tt class="docutils literal"><span class="pre">__getitem__()</span></tt>,
<tt class="docutils literal"><span class="pre">__setitem__()</span></tt>, <tt class="docutils literal"><span class="pre">__delitem__()</span></tt>, and <tt class="docutils literal"><span class="pre">keys()</span></tt>. For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">UserDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">SeqDict</span><span class="p">(</span><span class="n">UserDict</span><span class="o">.</span><span class="n">DictMixin</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&quot;&quot;&quot;Dictionary lookalike implemented with lists.&quot;&quot;&quot;</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">valuelist</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">KeyError</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valuelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">valuelist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span>            <span class="bp">self</span><span class="o">.</span><span class="n">valuelist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">try</span><span class="p">:</span>
<span class="gp">... </span>            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
<span class="gp">... </span>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<span class="gp">... </span>            <span class="k">raise</span> <span class="ne">KeyError</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>        <span class="bp">self</span><span class="o">.</span><span class="n">valuelist</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="gp">... </span>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keylist</span><span class="p">)</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SeqDict</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>      <span class="c"># See that other dictionary methods are implemented</span>
<span class="go">[&#39;__cmp__&#39;, &#39;__contains__&#39;, &#39;__delitem__&#39;, &#39;__doc__&#39;, &#39;__getitem__&#39;,</span>
<span class="go"> &#39;__init__&#39;, &#39;__iter__&#39;, &#39;__len__&#39;, &#39;__module__&#39;, &#39;__repr__&#39;,</span>
<span class="go"> &#39;__setitem__&#39;, &#39;clear&#39;, &#39;get&#39;, &#39;has_key&#39;, &#39;items&#39;, &#39;iteritems&#39;,</span>
<span class="go"> &#39;iterkeys&#39;, &#39;itervalues&#39;, &#39;keylist&#39;, &#39;keys&#39;, &#39;pop&#39;, &#39;popitem&#39;,</span>
<span class="go"> &#39;setdefault&#39;, &#39;update&#39;, &#39;valuelist&#39;, &#39;values&#39;]</span>
</pre></div>
</div>
<p>(Contributed by Raymond Hettinger.)</p>
</li>
<li><p class="first">The DOM implementation in <tt class="docutils literal"><span class="pre">xml.dom.minidom</span></tt> can now generate XML
output in a particular encoding by providing an optional encoding
argument to the <tt class="docutils literal"><span class="pre">toxml()</span></tt> and <tt class="docutils literal"><span class="pre">toprettyxml()</span></tt> methods of DOM
nodes.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">xmlrpclib</span></tt> module now supports an XML-RPC extension for
handling nil data values such as Python&#8217;s <tt class="xref docutils literal"><span class="pre">None</span></tt>.  Nil values are
always supported on unmarshalling an XML-RPC response.  To generate
requests containing <tt class="xref docutils literal"><span class="pre">None</span></tt>, you must supply a true value for the
<em>allow_none</em> parameter when creating a <tt class="docutils literal"><span class="pre">Marshaller</span></tt> instance.</p>
</li>
<li><p class="first">The new <tt class="docutils literal"><span class="pre">DocXMLRPCServer</span></tt> module allows writing self-documenting
XML-RPC servers. Run it in demo mode (as a program) to see it in
action.   Pointing the Web browser to the RPC server produces pydoc-
style documentation; pointing xmlrpclib to the server allows
invoking the actual methods. (Contributed by Brian Quinlan.)</p>
</li>
<li><p class="first">Support for internationalized domain names (RFCs 3454, 3490, 3491,
and 3492) has been added. The &#8220;idna&#8221; encoding can be used to convert
between a Unicode domain name and the ASCII-compatible encoding
(ACE) of that name.</p>
<blockquote>
<p>&gt;{}&gt;{}&gt; u&#8221;www.Alliancefrançaise.nu&#8221;.encode(&#8220;idna&#8221;)
&#8216;www.xn&#8211;alliancefranaise-npb.nu&#8217;</p>
</blockquote>
<p>The <tt class="docutils literal"><span class="pre">socket</span></tt> module has also been extended to transparently
convert Unicode hostnames to the ACE version before passing them to
the C library. Modules that deal with hostnames such as <tt class="docutils literal"><span class="pre">httplib</span></tt>
and <tt class="docutils literal"><span class="pre">ftplib</span></tt>) also support Unicode host names; <tt class="docutils literal"><span class="pre">httplib</span></tt> also
sends HTTP <tt class="docutils literal"><span class="pre">Host</span></tt> headers using the ACE version of the domain
name.  <tt class="docutils literal"><span class="pre">urllib</span></tt> supports Unicode URLs with non-ASCII host names as
long as the <tt class="docutils literal"><span class="pre">path</span></tt> part of the URL is ASCII only.</p>
<p>To implement this change, the <tt class="docutils literal"><span class="pre">stringprep</span></tt> module, the
<tt class="docutils literal"><span class="pre">mkstringprep</span></tt> tool and the <tt class="docutils literal"><span class="pre">punycode</span></tt> encoding have been added.</p>
</li>
</ul>
<div class="section" id="date-time-type">
<h3>Date/Time Type<a class="headerlink" href="#date-time-type" title="Permalink to this headline">¶</a></h3>
<p>Date and time types suitable for expressing timestamps were added as
the <tt class="docutils literal"><span class="pre">datetime</span></tt> module.  The types don&#8217;t support different calendars
or many fancy features, and just stick to the basics of representing
time.</p>
<p>The three primary types are: <tt class="docutils literal"><span class="pre">date</span></tt>, representing a day, month, and
year; <tt class="docutils literal"><span class="pre">time</span></tt>, consisting of hour, minute, and second; and
<tt class="docutils literal"><span class="pre">datetime</span></tt>, which contains all the attributes of both <tt class="docutils literal"><span class="pre">date</span></tt> and
<tt class="docutils literal"><span class="pre">time</span></tt>. There&#8217;s also a <tt class="docutils literal"><span class="pre">timedelta</span></tt> class representing differences
between two points in time, and time zone logic is implemented by
classes inheriting from the abstract <tt class="docutils literal"><span class="pre">tzinfo</span></tt> class.</p>
<p>You can create instances of <tt class="docutils literal"><span class="pre">date</span></tt> and <tt class="docutils literal"><span class="pre">time</span></tt> by either supplying
keyword arguments to the appropriate constructor, e.g.
<tt class="docutils literal"><span class="pre">datetime.date(year=1972,</span> <span class="pre">month=10,</span> <span class="pre">day=15)</span></tt>, or by using one of a
number of class methods.  For example, the <tt class="docutils literal"><span class="pre">date.today()</span></tt> class
method returns the current local date.</p>
<p>Once created, instances of the date/time classes are all immutable.
There are a number of methods for producing formatted strings from
objects:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">now</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
<span class="go">&#39;2002-12-30T21:27:03.994956&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">now</span><span class="o">.</span><span class="n">ctime</span><span class="p">()</span>  <span class="c"># Only available on date, datetime</span>
<span class="go">&#39;Mon Dec 30 21:27:03 2002&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">&#39;%Y </span><span class="si">%d</span><span class="s"> %b&#39;</span><span class="p">)</span>
<span class="go">&#39;2002 30 Dec&#39;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">replace()</span></tt> method allows modifying one or more fields  of a
<tt class="docutils literal"><span class="pre">date</span></tt> or <tt class="docutils literal"><span class="pre">datetime</span></tt> instance, returning a new instance:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">datetime.datetime(2002, 12, 30, 22, 15, 38, 827738)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="mf">2001</span><span class="p">,</span> <span class="n">hour</span> <span class="o">=</span> <span class="mf">12</span><span class="p">)</span>
<span class="go">datetime.datetime(2001, 12, 30, 12, 15, 38, 827738)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>Instances can be compared, hashed, and converted to strings (the
result is the same as that of <tt class="docutils literal"><span class="pre">isoformat()</span></tt>).  <tt class="docutils literal"><span class="pre">date</span></tt> and
<tt class="docutils literal"><span class="pre">datetime</span></tt> instances can be subtracted from each other, and added to
<tt class="docutils literal"><span class="pre">timedelta</span></tt> instances.  The largest missing feature is that there&#8217;s
no standard library support for parsing strings and getting back a
<tt class="docutils literal"><span class="pre">date</span></tt> or <tt class="docutils literal"><span class="pre">datetime</span></tt>.</p>
<p>For more information, refer to the module&#8217;s reference documentation.
(Contributed by Tim Peters.)</p>
</div>
<div class="section" id="the-optparse-module">
<h3>The optparse Module<a class="headerlink" href="#the-optparse-module" title="Permalink to this headline">¶</a></h3>
<p>The <tt class="docutils literal"><span class="pre">getopt</span></tt> module provides simple parsing of command-line
arguments.  The new <tt class="docutils literal"><span class="pre">optparse</span></tt> module (originally named Optik)
provides more elaborate command-line parsing that follows the Unix
conventions, automatically creates the output for <em>&#8211;help</em>, and can
perform different actions for different options.</p>
<p>You start by creating an instance of <tt class="docutils literal"><span class="pre">OptionParser</span></tt> and telling it
what your program&#8217;s options are.</p>
<blockquote>
<p>import sys
from optparse import OptionParser</p>
<p>op = OptionParser()
op.add_option(&#8216;-i&#8217;, &#8216;&#8211;input&#8217;,</p>
<blockquote>
action=&#8217;store&#8217;, type=&#8217;string&#8217;, dest=&#8217;input&#8217;,
help=&#8217;set input filename&#8217;)</blockquote>
<dl class="docutils">
<dt>op.add_option(&#8216;-l&#8217;, &#8216;&#8211;length&#8217;,</dt>
<dd>action=&#8217;store&#8217;, type=&#8217;int&#8217;, dest=&#8217;length&#8217;,
help=&#8217;set maximum length of output&#8217;)</dd>
</dl>
</blockquote>
<p>Parsing a command line is then done by calling the <tt class="docutils literal"><span class="pre">parse_args()</span></tt>
method.</p>
<blockquote>
options, args = op.parse_args(sys.argv[1:])
print options
print args</blockquote>
<p>This returns an object containing all of the option values, and a list
of strings containing the remaining arguments.</p>
<p>Invoking the script with the various arguments now works as you&#8217;d
expect it to. Note that the length argument is automatically converted
to an integer.</p>
<blockquote>
$ ./python opt.py -i data arg1
&lt;Values at 0x400cad4c: {&#8216;input&#8217;: &#8216;data&#8217;, &#8216;length&#8217;: None}&gt;
[&#8216;arg1&#8217;]
$ ./python opt.py &#8211;input=data &#8211;length=4
&lt;Values at 0x400cad2c: {&#8216;input&#8217;: &#8216;data&#8217;, &#8216;length&#8217;: 4}&gt;
[]
$</blockquote>
<p>The help message is automatically generated for you:</p>
<blockquote>
<p>$ ./python opt.py &#8211;help
usage: opt.py [options]</p>
<dl class="docutils">
<dt>options:</dt>
<dd><table class="first last docutils option-list" frame="void" rules="none">
<col class="option" />
<col class="description" />
<tbody valign="top">
<tr><td class="option-group">
<kbd><span class="option">-h</span>, <span class="option">--help</span></kbd></td>
<td>show this help message and exit</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-i<var>INPUT</var></span>, <span class="option">--input=<var>INPUT</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>set input filename</td></tr>
<tr><td class="option-group" colspan="2">
<kbd><span class="option">-l<var>LENGTH</var></span>, <span class="option">--length=<var>LENGTH</var></span></kbd></td>
</tr>
<tr><td>&nbsp;</td><td>set maximum length of output</td></tr>
</tbody>
</table>
</dd>
</dl>
<p>$</p>
</blockquote>
<p>See the module&#8217;s documentation for more details.</p>
<p>Optik was written by Greg Ward, with suggestions from the readers of
the Getopt SIG.</p>
</div>
</div>
<div class="section" id="pymalloc-a-specialized-object-allocator">
<h2>Pymalloc: A Specialized Object Allocator<a class="headerlink" href="#pymalloc-a-specialized-object-allocator" title="Permalink to this headline">¶</a></h2>
<p>Pymalloc, a specialized object allocator written by Vladimir
Marangozov, was a feature added to Python 2.1.  Pymalloc is intended
to be faster than the system <tt class="docutils literal"><span class="pre">malloc()</span></tt> and to have less memory
overhead for allocation patterns typical of Python programs. The
allocator uses C&#8217;s <tt class="docutils literal"><span class="pre">malloc()</span></tt> function to get large pools of memory
and then fulfills smaller memory requests from these pools.</p>
<p>In 2.1 and 2.2, pymalloc was an experimental feature and wasn&#8217;t
enabled by default; you had to explicitly enable it when compiling
Python by providing the <em>&#8211;with-pymalloc</em> option to the <strong>configure</strong>
script.  In 2.3, pymalloc has had further enhancements and is now
enabled by default; you&#8217;ll have to supply <em>&#8211;without-pymalloc</em> to
disable it.</p>
<p>This change is transparent to code written in Python; however,
pymalloc may expose bugs in C extensions.  Authors of C extension
modules should test their code with pymalloc enabled, because some
incorrect code may cause core dumps at runtime.</p>
<p>There&#8217;s one particularly common error that causes problems.  There are
a number of memory allocation functions in Python&#8217;s C API that have
previously just been aliases for the C library&#8217;s <tt class="docutils literal"><span class="pre">malloc()</span></tt> and
<tt class="docutils literal"><span class="pre">free()</span></tt>, meaning that if you accidentally called mismatched
functions the error wouldn&#8217;t be noticeable. When the object allocator
is enabled, these functions aren&#8217;t aliases of <tt class="docutils literal"><span class="pre">malloc()</span></tt> and
<tt class="docutils literal"><span class="pre">free()</span></tt> any more, and calling the wrong function to free memory may
get you a core dump.  For example, if memory was allocated using
<tt class="docutils literal"><span class="pre">PyObject_Malloc()</span></tt>, it has to be freed using <tt class="docutils literal"><span class="pre">PyObject_Free()</span></tt>,
not <tt class="docutils literal"><span class="pre">free()</span></tt>.  A few modules included with Python fell afoul of this
and had to be fixed; doubtless there are more third-party modules that
will have the same problem.</p>
<p>As part of this change, the confusing multiple interfaces for
allocating memory have been consolidated down into two API families.
Memory allocated with one family must not be manipulated with
functions from the other family.  There is one family for allocating
chunks of memory and another family of functions specifically for
allocating Python objects.</p>
<ul class="simple">
<li>To allocate and free an undistinguished chunk of memory use the &#8220;raw
memory&#8221; family: <tt class="docutils literal"><span class="pre">PyMem_Malloc()</span></tt>, <tt class="docutils literal"><span class="pre">PyMem_Realloc()</span></tt>, and
<tt class="docutils literal"><span class="pre">PyMem_Free()</span></tt>.</li>
<li>The &#8220;object memory&#8221; family is the interface to the pymalloc facility
described above and is biased towards a large number of &#8220;small&#8221;
allocations: <tt class="docutils literal"><span class="pre">PyObject_Malloc()</span></tt>, <tt class="docutils literal"><span class="pre">PyObject_Realloc()</span></tt>, and
<tt class="docutils literal"><span class="pre">PyObject_Free()</span></tt>.</li>
<li>To allocate and free Python objects, use the &#8220;object&#8221; family
<tt class="docutils literal"><span class="pre">PyObject_New()</span></tt>, <tt class="docutils literal"><span class="pre">PyObject_NewVar()</span></tt>, and <tt class="docutils literal"><span class="pre">PyObject_Del()</span></tt>.</li>
</ul>
<p>Thanks to lots of work by Tim Peters, pymalloc in 2.3 also provides
debugging features to catch memory overwrites and doubled frees in
both extension modules and in the interpreter itself.  To enable this
support, compile a debugging version of the Python interpreter by
running <strong>configure</strong> with <em>&#8211;with-pydebug</em>.</p>
<p>To aid extension writers, a header file <tt class="docutils literal"><span class="pre">Misc/pymemcompat.h</span></tt> is
distributed with the source to Python 2.3 that allows Python
extensions to use the 2.3 interfaces to memory allocation while
compiling against any version of Python since 1.5.2.  You would copy
the file from Python&#8217;s source distribution and bundle it with the
source of your extension.</p>
<p>See also:</p>
<blockquote>
<p><a class="reference external" href="http://cvs.sourceforge.net/cgi">http://cvs.sourceforge.net/cgi</a>-
bin/viewcvs.cgi/python/python/dist/src/Objects/obmalloc.c</p>
<blockquote>
For the full details of the pymalloc implementation, see the
comments at the top of the file <tt class="docutils literal"><span class="pre">Objects/obmalloc.c</span></tt> in the
Python source code.  The above link points to the file within
the SourceForge CVS browser.</blockquote>
</blockquote>
</div>
<div class="section" id="build-and-c-api-changes">
<h2>Build and C API Changes<a class="headerlink" href="#build-and-c-api-changes" title="Permalink to this headline">¶</a></h2>
<p>Changes to Python&#8217;s build process and to the C API include:</p>
<ul class="simple">
<li>The cycle detection implementation used by the garbage collection
has proven to be stable, so it&#8217;s now been made mandatory.  You can
no longer compile Python without it, and the <em>&#8211;with-cycle-gc</em>
switch to <strong>configure</strong> has been removed.</li>
<li>Python can now optionally be built as a shared library
(<tt class="docutils literal"><span class="pre">libpython2.3.so</span></tt>) by supplying <em>&#8211;enable-shared</em> when running
Python&#8217;s <strong>configure</strong> script.  (Contributed by Ondrej Palkovsky.)</li>
<li>The <tt class="docutils literal"><span class="pre">DL_EXPORT</span></tt> and <tt class="docutils literal"><span class="pre">DL_IMPORT</span></tt> macros are now deprecated.
Initialization functions for Python extension modules should now be
declared using the new macro <tt class="docutils literal"><span class="pre">PyMODINIT_FUNC</span></tt>, while the Python
core will generally use the <tt class="docutils literal"><span class="pre">PyAPI_FUNC</span></tt> and <tt class="docutils literal"><span class="pre">PyAPI_DATA</span></tt>
macros.</li>
<li>The interpreter can be compiled without any docstrings for the
built-in functions and modules by supplying <em>&#8211;without-doc-strings</em>
to the <strong>configure</strong> script. This makes the Python executable about
10% smaller, but will also mean that you can&#8217;t get help for Python&#8217;s
built-ins.  (Contributed by Gustavo Niemeyer.)</li>
<li>The <tt class="docutils literal"><span class="pre">PyArg_NoArgs()</span></tt> macro is now deprecated, and code that uses
it should be changed.  For Python 2.2 and later, the method
definition table can specify the <tt class="docutils literal"><span class="pre">METH_NOARGS</span></tt> flag, signalling
that there are no arguments, and the argument checking can then be
removed.  If compatibility with pre-2.2 versions of Python is
important, the code could use <tt class="docutils literal"><span class="pre">PyArg_ParseTuple(args,</span> <span class="pre">&quot;&quot;)</span></tt>
instead, but this will be slower than using <tt class="docutils literal"><span class="pre">METH_NOARGS</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">PyArg_ParseTuple()</span></tt> accepts new format characters for various
sizes of unsigned integers: <tt class="docutils literal"><span class="pre">B</span></tt> for <tt class="docutils literal"><span class="pre">unsigned</span> <span class="pre">char</span></tt>, <tt class="docutils literal"><span class="pre">H</span></tt> for
<tt class="docutils literal"><span class="pre">unsigned</span> <span class="pre">short</span> <span class="pre">int</span></tt>,  <tt class="docutils literal"><span class="pre">I</span></tt> for <tt class="docutils literal"><span class="pre">unsigned</span> <span class="pre">int</span></tt>,  and <tt class="docutils literal"><span class="pre">K</span></tt> for
<tt class="docutils literal"><span class="pre">unsigned</span> <span class="pre">long</span> <span class="pre">long</span></tt>.</li>
<li>A new function, <tt class="docutils literal"><span class="pre">PyObject_DelItemString(mapping,</span> <span class="pre">char</span> <span class="pre">*key)()</span></tt> was
added as shorthand for <tt class="docutils literal"><span class="pre">PyObject_DelItem(mapping,</span>
<span class="pre">PyString_New(key))</span></tt>.</li>
<li>File objects now manage their internal string buffer differently,
increasing it exponentially when needed.  This results in the
benchmark tests in <tt class="docutils literal"><span class="pre">Lib/test/test_bufio.py</span></tt> speeding up
considerably (from 57 seconds to 1.7 seconds, according to one
measurement).</li>
<li>It&#8217;s now possible to define class and static methods for a C
extension type by setting either the <tt class="docutils literal"><span class="pre">METH_CLASS</span></tt> or
<tt class="docutils literal"><span class="pre">METH_STATIC</span></tt> flags in a method&#8217;s <tt class="docutils literal"><span class="pre">PyMethodDef</span></tt> structure.</li>
<li>Python now includes a copy of the Expat XML parser&#8217;s source code,
removing any dependence on a system version or local installation of
Expat.</li>
<li>If you dynamically allocate type objects in your extension, you
should be aware of a change in the rules relating to the
<tt class="docutils literal"><span class="pre">__module__</span></tt> and <tt class="docutils literal"><span class="pre">__name__</span></tt> attributes.  In summary, you will
want to ensure the type&#8217;s dictionary contains a <tt class="docutils literal"><span class="pre">'__module__'</span></tt>
key; making the module name the part of the type name leading up to
the final period will no longer have the desired effect.  For more
detail, read the API reference documentation or the  source.</li>
</ul>
<div class="section" id="port-specific-changes">
<h3>Port-Specific Changes<a class="headerlink" href="#port-specific-changes" title="Permalink to this headline">¶</a></h3>
<p>Support for a port to IBM&#8217;s OS/2 using the EMX runtime environment was
merged into the main Python source tree.  EMX is a POSIX emulation
layer over the OS/2 system APIs.  The Python port for EMX tries to
support all the POSIX-like capability exposed by the EMX runtime, and
mostly succeeds; <tt class="docutils literal"><span class="pre">fork()</span></tt> and <tt class="docutils literal"><span class="pre">fcntl()</span></tt> are restricted by the
limitations of the underlying emulation layer.  The standard OS/2
port, which uses IBM&#8217;s Visual Age compiler, also gained support for
case-sensitive import semantics as part of the integration of the EMX
port into CVS.  (Contributed by Andrew MacIntyre.)</p>
<p>On MacOS, most toolbox modules have been weaklinked to improve
backward compatibility.  This means that modules will no longer fail
to load if a single routine is missing on the current OS version.
Instead calling the missing routine will raise an exception.
(Contributed by Jack Jansen.)</p>
<p>The RPM spec files, found in the <tt class="docutils literal"><span class="pre">Misc/RPM/</span></tt> directory in the Python
source distribution, were updated for 2.3.  (Contributed by Sean
Reifschneider.)</p>
<p>Other new platforms now supported by Python include AtheOS
(<a class="reference external" href="http://www.atheos.cx/">http://www.atheos.cx/</a>), GNU/Hurd, and OpenVMS.</p>
</div>
</div>
<div class="section" id="other-changes-and-fixes">
<h2>Other Changes and Fixes<a class="headerlink" href="#other-changes-and-fixes" title="Permalink to this headline">¶</a></h2>
<p>As usual, there were a bunch of other improvements and bugfixes
scattered throughout the source tree.  A search through the CVS change
logs finds there were 523 patches applied and 514 bugs fixed between
Python 2.2 and 2.3.  Both figures are likely to be underestimates.</p>
<p>Some of the more notable changes are:</p>
<ul>
<li><p class="first">If the <strong>PYTHONINSPECT</strong> environment variable is set, the Python
interpreter will enter the interactive prompt after running a Python
program, as if Python had been invoked with the <em>-i</em> option. The
environment variable can be set before running the Python
interpreter, or it can be set by the Python program as part of its
execution.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">regrtest.py</span></tt> script now provides a way to allow &#8220;all
resources except <em>foo</em>.&#8221;  A resource name passed to the <em>-u</em> option
can now be prefixed with a hyphen (<tt class="docutils literal"><span class="pre">'-'</span></tt>) to mean &#8220;remove this
resource.&#8221;  For example, the option &#8216;<tt class="docutils literal"><span class="pre">-uall,-bsddb</span></tt>&#8216; could be used
to enable the use of all resources except <tt class="docutils literal"><span class="pre">bsddb</span></tt>.</p>
</li>
<li><p class="first">The tools used to build the documentation now work under Cygwin as
well as Unix.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">SET_LINENO</span></tt> opcode has been removed.  Back in the mists of
time, this opcode was needed to produce line numbers in tracebacks
and support trace functions (for, e.g., <tt class="docutils literal"><span class="pre">pdb</span></tt>). Since Python 1.5,
the line numbers in tracebacks have been computed using a different
mechanism that works with &#8220;python -O&#8221;.  For Python 2.3 Michael
Hudson implemented a similar scheme to determine when to call the
trace function, removing the need for <tt class="docutils literal"><span class="pre">SET_LINENO</span></tt> entirely.</p>
<p>It would be difficult to detect any resulting difference from Python
code, apart from a slight speed up when Python is run without <em>-O</em>.</p>
<p>C extensions that access the <tt class="docutils literal"><span class="pre">f_lineno</span></tt> field of frame objects
should instead call <tt class="docutils literal"><span class="pre">PyCode_Addr2Line(f-&gt;f_code,</span> <span class="pre">f-&gt;f_lasti)</span></tt>.
This will have the added effect of making the code work as desired
under &#8220;python -O&#8221; in earlier versions of Python.</p>
<p>A nifty new feature is that trace functions can now assign to the
<tt class="docutils literal"><span class="pre">f_lineno</span></tt> attribute of frame objects, changing the line that will
be executed next.  A <tt class="docutils literal"><span class="pre">jump</span></tt> command has been added to the <tt class="docutils literal"><span class="pre">pdb</span></tt>
debugger taking advantage of this new feature. (Implemented by
Richie Hindle.)</p>
</li>
</ul>
</div>
<div class="section" id="porting-to-python-2-3">
<h2>Porting to Python 2.3<a class="headerlink" href="#porting-to-python-2-3" title="Permalink to this headline">¶</a></h2>
<p>This section lists previously described changes that may require
changes to your code:</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">yield</span></tt> is now always a keyword; if it&#8217;s used as a variable name
in your code, a different name must be chosen.</p>
</li>
<li><p class="first">For strings <em>X</em> and <em>Y</em>, <tt class="docutils literal"><span class="pre">X</span> <span class="pre">in</span> <span class="pre">Y</span></tt> now works if <em>X</em> is more than
one character long.</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">int()</span></tt> type constructor will now return a long integer
instead of raising an <tt class="docutils literal"><span class="pre">OverflowError</span></tt> when a string or floating-
point number is too large to fit into an integer.</p>
</li>
<li><p class="first">If you have Unicode strings that contain 8-bit characters, you must
declare the file&#8217;s encoding (UTF-8, Latin-1, or whatever) by adding
a comment to the top of the file.  See section <em>PEP 263: Source Code
Encodings</em> for more information.</p>
</li>
<li><p class="first">Calling Tcl methods through <tt class="docutils literal"><span class="pre">_tkinter</span></tt> no longer  returns only
strings. Instead, if Tcl returns other objects those objects are
converted to their Python equivalent, if one exists, or wrapped with
a <tt class="docutils literal"><span class="pre">_tkinter.Tcl_Obj</span></tt> object if no Python equivalent exists.</p>
</li>
<li><p class="first">Large octal and hex literals such as <tt class="docutils literal"><span class="pre">0xffffffff</span></tt> now trigger a
<tt class="docutils literal"><span class="pre">FutureWarning</span></tt>. Currently they&#8217;re stored as 32-bit numbers and
result in a negative value, but in Python 2.4 they&#8217;ll become
positive long integers.</p>
<p>There are a few ways to fix this warning.  If you really need a
positive number, just add an <tt class="docutils literal"><span class="pre">L</span></tt> to the end of the literal.  If
you&#8217;re trying to get a 32-bit integer with low bits set and have
previously used an expression such as <tt class="docutils literal"><span class="pre">~(1</span> <span class="pre">&lt;&lt;</span> <span class="pre">31)</span></tt>, it&#8217;s probably
clearest to start with all bits set and clear the desired upper
bits. For example, to clear just the top bit (bit 31), you could
write <tt class="docutils literal"><span class="pre">0xffffffffL</span> <span class="pre">&amp;~(1L&lt;&lt;31)</span></tt>.</p>
</li>
<li><p class="first">You can no longer disable assertions by assigning to <tt class="docutils literal"><span class="pre">__debug__</span></tt>.</p>
</li>
<li><p class="first">The Distutils <tt class="docutils literal"><span class="pre">setup()</span></tt> function has gained various new keyword
arguments such as <em>depends</em>.  Old versions of the Distutils will
abort if passed unknown keywords.  A solution is to check for the
presence of the new <tt class="docutils literal"><span class="pre">get_distutil_options()</span></tt> function in your
<tt class="docutils literal"><span class="pre">setup.py</span></tt> and only uses the new keywords with a version of the
Distutils that supports them:</p>
<blockquote>
<p>from distutils import core</p>
<p>kw = {&#8216;sources&#8217;: &#8216;foo.c&#8217;, ...}
if hasattr(core, &#8216;get_distutil_options&#8217;):</p>
<blockquote>
<p>kw[&#8216;depends&#8217;] = [&#8216;foo.h&#8217;]</p>
</blockquote>
<p>ext = Extension(<a href="#id5"><span class="problematic" id="id6">**</span></a>kw)</p>
</blockquote>
</li>
<li><p class="first">Using <tt class="xref docutils literal"><span class="pre">None</span></tt> as a variable name will now result in a
<tt class="docutils literal"><span class="pre">SyntaxWarning</span></tt> warning.</p>
</li>
<li><p class="first">Names of extension types defined by the modules included with Python
now contain the module and a <tt class="docutils literal"><span class="pre">'.'</span></tt> in front of the type name.</p>
</li>
</ul>
</div>
<div class="section" id="acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>The author would like to thank the following people for offering
suggestions, corrections and assistance with various drafts of this
article: Jeff Bauer, Simon Brunning, Brett Cannon, Michael Chermside,
Andrew Dalke, Scott David Daniels, Fred L. Drake, Jr., David Fraser,
Kelly Gerber, Raymond Hettinger, Michael Hudson, Chris Lambert, Detlef
Lannert, Martin von Löwis, Andrew MacIntyre, Lalo Martins, Chad
Netzer, Gustavo Niemeyer, Neal Norwitz, Hans Nowak, Chris Reedy,
Francesco Ricciardi, Vinay Sajip, Neil Schemenauer, Roman Suzi, Jason
Tishler, Just van Rossum.</p>
</div>
</div>


          </div>
        </div>
      </div>


      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">Jython v2.5.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
      &copy; <a href="../copyright.html">Copyright</a> 2009, Jython Project.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 0.6.1.
    </div>
  </body>
</html>